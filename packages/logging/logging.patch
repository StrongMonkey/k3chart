diff -uNr packages/logging/charts-original/app-readme.md packages/logging/charts/app-readme.md
--- packages/logging/charts-original/app-readme.md	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/app-readme.md	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,8 @@
+# Rancher Logging
+
+* Installs [Fluentd](https://www.fluentd.org/) and flexvolume log driver to collect container logs in Rancher
+
+## Changelog
+
+* 0.1.5
+    * Added option `global.privileged` to enable the privileged securityContext in logging containers. This is needed when running SELinux enabled Docker on the host(s).
diff -uNr packages/logging/charts-original/charts/fluentd/charts/fluentd-linux/Chart.yaml packages/logging/charts/charts/fluentd/charts/fluentd-linux/Chart.yaml
--- packages/logging/charts-original/charts/fluentd/charts/fluentd-linux/Chart.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/charts/fluentd-linux/Chart.yaml	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,17 @@
+name: fluentd-linux
+version: 0.0.2
+appVersion: 1.6.3
+home: https://www.fluentd.org/
+description: A Fluentd Helm chart for Rancher system logging
+icon: https://raw.githubusercontent.com/fluent/fluentd-docs/master/public/logo/Fluentd_square.png
+keywords:
+- fluentd
+- rancher
+- logging
+- linux
+sources:
+- https://github.com/helm/charts/stable/fluentd-elasticsearch
+maintainers:
+- name: michelia
+  email: support@rancher.com
+engine: gotpl
diff -uNr packages/logging/charts-original/charts/fluentd/charts/fluentd-linux/templates/daemonset.yaml packages/logging/charts/charts/fluentd/charts/fluentd-linux/templates/daemonset.yaml
--- packages/logging/charts-original/charts/fluentd/charts/fluentd-linux/templates/daemonset.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/charts/fluentd-linux/templates/daemonset.yaml	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,195 @@
+apiVersion: {{ template "daemonset_api_version" . }}
+kind: DaemonSet
+metadata:
+  name: {{ template "fluentd.fullname" . }}-linux
+  labels:
+    app: {{ template "fluentd.name" . }}
+    chart: {{ template "fluentd.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+{{- if .Values.labels }}
+{{ toYaml .Values.labels | indent 4 }}
+{{- end }}
+spec:
+{{- if .Values.updateStrategy }}
+  updateStrategy:
+{{ toYaml .Values.updateStrategy | indent 4 }}
+{{- end }}
+  selector:
+    matchLabels:
+      app: {{ template "fluentd.name" . }}
+      release: {{ .Release.Name }}
+  template:
+    metadata:
+      labels:
+        app: {{ template "fluentd.name" . }}
+        chart: {{ template "fluentd.version" . }}
+        release: {{ .Release.Name }}
+        heritage: {{ .Release.Service }}
+    {{- if .Values.labels }}
+    {{ toYaml .Values.labels | indent 4 }}
+    {{- end }}
+{{- if .Values.annotations }}
+{{ toYaml .Values.annotations | indent 8 }}
+{{- end }}
+    spec:
+      serviceAccountName: {{ template "fluentd.fullname" . }}
+      containers:
+      - name: {{ template "fluentd.fullname" . }}
+        image:  {{ template "system_default_registry" . }}{{ .Values.image.repository }}:{{ .Values.image.tag }}
+        imagePullPolicy: {{ .Values.image.pullPolicy | quote }}
+{{- if .Values.global.privileged }}
+        securityContext:
+          privileged: true
+{{- end }}
+        {{- if .Values.command }}
+        command: {{ .Values.command }}
+        {{ end }}
+        env:
+        {{- range $key, $value := .Values.env }}
+        - name: {{ $key }}
+          value: {{ $value | quote }}
+        {{- end }}
+        - name: K8S_NODE_NAME
+          valueFrom:
+            fieldRef:
+              fieldPath: spec.nodeName
+        resources:
+{{ toYaml .Values.resources | indent 10 }}
+        volumeMounts:
+        - mountPath: /fluentd/etc/config/custom
+          name: custom
+        - mountPath: /fluentd/etc/config/precan
+          name: config
+        - mountPath: /fluentd/etc/config/entry
+          name: entry
+        - mountPath: /fluentd/etc/config/ssl
+          name: ssl
+        - mountPath: {{ .Values.cluster.dockerRoot }}
+          name: dockerroot
+        - mountPath: /var/log/containers
+          name: varlogcontainers
+        - mountPath: /var/log/pods
+          name: varlogpods
+        - mountPath: /var/lib/rancher/rke/log
+          name: rkelog
+        - mountPath: /var/lib/rancher/log-volumes
+          name: customlog
+        - mountPath: /fluentd/log
+          name: fluentdlog
+        - name: libsystemddir
+          mountPath: /host/lib
+          readOnly: true
+{{- if .Values.extraVolumeMounts }}
+{{ toYaml .Values.extraVolumeMounts | indent 8 }}
+{{- end }}
+        ports:
+{{- range $port := .Values.service.ports }}
+          - name: {{ $port.name }}
+            containerPort: {{ $port.port }}
+{{- if $port.protocol }}
+            protocol: {{ $port.protocol }}
+{{- end }}
+{{- end }}
+{{- if .Values.livenessProbe.enabled }}
+        # Liveness probe is aimed to help in situarions where fluentd
+        # silently hangs for no apparent reasons until manual restart.
+        # The idea of this probe is that if fluentd is not queueing or
+        # flushing chunks for 5 minutes, something is not right. If
+        # you want to change the fluentd configuration, reducing amount of
+        # logs fluentd collects, consider changing the threshold or turning
+        # liveness probe off completely.
+        livenessProbe:
+          initialDelaySeconds: 600
+          periodSeconds: 60
+          exec:
+            command:
+            - '/bin/sh'
+            - '-c'
+            - >
+              LIVENESS_THRESHOLD_SECONDS=${LIVENESS_THRESHOLD_SECONDS:-300};
+              STUCK_THRESHOLD_SECONDS=${LIVENESS_THRESHOLD_SECONDS:-900};
+              if [ ! -e /fluentd/log/buffer ];
+              then
+                exit 1;
+              fi;
+              touch -d "${STUCK_THRESHOLD_SECONDS} seconds ago" /tmp/marker-stuck;
+              if [[ -z "$(find /fluentd/log/buffer -type f -newer /tmp/marker-stuck -print -quit)" ]];
+              then
+                rm -rf /fluentd/log/buffer;
+                exit 1;
+              fi;
+              touch -d "${LIVENESS_THRESHOLD_SECONDS} seconds ago" /tmp/marker-liveness;
+              if [[ -z "$(find /fluentd/log/buffer -type f -newer /tmp/marker-liveness -print -quit)" ]];
+              then
+                exit 1;
+              fi;
+{{- end }}
+      - name: {{ template "fluentd.fullname" . }}-{{ .Values.configmapReload.name }}
+        image: {{ template "system_default_registry" . }}{{ .Values.configmapReload.image.repository }}:{{ .Values.configmapReload.image.tag }}
+        imagePullPolicy: "{{ .Values.configmapReload.image.pullPolicy }}"
+        args:
+          - --volume-dir=/fluentd/etc/config/custom
+          - --volume-dir=/fluentd/etc/config/precan
+          - --volume-dir=/fluentd/etc/config/ssl
+          - --volume-dir=/fluentd/etc/config/entry
+          - --webhook-method=GET
+          - --webhook-url=http://127.0.0.1:24444/api/config.reload
+        resources:
+        {{ toYaml .Values.configmapReload.resources | indent 12 }}
+        volumeMounts:
+          - mountPath: /fluentd/etc/config/custom
+            name: custom
+          - mountPath: /fluentd/etc/config/precan
+            name: config
+          - mountPath: /fluentd/etc/config/entry
+            name: entry
+          - mountPath: /fluentd/etc/config/ssl
+            name: ssl
+      terminationGracePeriodSeconds: 30
+      volumes:
+      - hostPath:
+          path: /var/lib/rancher/fluentd/etc/config/custom
+        name: custom
+      - hostPath:
+          path: {{ .Values.cluster.dockerRoot }}
+        name: dockerroot
+      - hostPath:
+          path: /var/log/containers
+        name: varlogcontainers
+      - hostPath:
+          path: /var/log/pods
+        name: varlogpods
+      - hostPath:
+          path: /var/lib/rancher/rke/log
+        name: rkelog
+      - hostPath:
+          path: /var/lib/rancher/log-volumes
+        name: customlog
+      - hostPath:
+          path: /var/lib/rancher/fluentd/log
+        name: fluentdlog
+      - name: config
+        secret:
+          secretName: {{ template "fluentd.fullname" . }}
+      - name: entry
+        secret:
+          secretName: {{ template "fluentd.fullname" . }}-entry
+      - name: ssl
+        secret:
+          secretName: {{ template "fluentd.fullname" . }}-ssl
+      - name: libsystemddir
+        hostPath:
+          path: /usr/lib64
+{{- if .Values.extraVolumes }}
+{{ toYaml .Values.extraVolumes | indent 6 }}
+{{- end }}
+      nodeSelector:
+{{- include "linux-node-selector" . | nindent 8 }}
+{{- if .Values.nodeSelector }}
+{{ toYaml .Values.nodeSelector | indent 8 }}
+{{- end }}
+{{- if .Values.tolerations }}
+      tolerations:
+{{ toYaml .Values.tolerations | indent 6 }}
+{{- end }}
diff -uNr packages/logging/charts-original/charts/fluentd/charts/fluentd-linux/values.yaml packages/logging/charts/charts/fluentd/charts/fluentd-linux/values.yaml
--- packages/logging/charts-original/charts/fluentd/charts/fluentd-linux/values.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/charts/fluentd-linux/values.yaml	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,56 @@
+nameOverride: fluentd
+labels: {}
+
+image:
+  repository: rancher/fluentd
+  tag: v0.1.19
+  pullPolicy: IfNotPresent
+
+resources: {}
+  # limits:
+  #   cpu: 100m
+  #   memory: 500Mi
+  # requests:
+  #   cpu: 100m
+  #   memory: 200Mi
+# env:
+
+command: '["fluentd", "-c", "/fluentd/etc/config/entry/fluent.conf"]'
+
+livenessProbe:
+  enabled: true
+
+annotations: {}
+
+# updateStrategy:
+#   type: RollingUpdate
+
+tolerations:
+  - effect: NoSchedule
+    operator: Exists
+
+nodeSelector: {}
+
+service:
+  type: ClusterIP
+  ports:
+    - name: metric
+      port: 24231
+      targetPort: metric
+
+cluster:
+  dockerRoot: /var/lib/docker
+
+service:
+  ports:
+    - name: metric
+      port: 24231
+      targetPort: metric
+
+configmapReload:
+  name: reloader
+  image:
+    repository: rancher/configmap-reload
+    tag: v0.3.0-rancher2
+    pullPolicy: IfNotPresent
+  resources: {}
\ No newline at end of file
diff -uNr packages/logging/charts-original/charts/fluentd/charts/fluentd-windows/Chart.yaml packages/logging/charts/charts/fluentd/charts/fluentd-windows/Chart.yaml
--- packages/logging/charts-original/charts/fluentd/charts/fluentd-windows/Chart.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/charts/fluentd-windows/Chart.yaml	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,17 @@
+name: fluentd-windows
+version: 0.0.1
+appVersion: 1.6.3
+home: https://www.fluentd.org/
+description: A Fluentd Helm chart for Rancher system logging
+icon: https://raw.githubusercontent.com/fluent/fluentd-docs/master/public/logo/Fluentd_square.png
+keywords:
+- fluentd
+- rancher
+- logging
+- windows
+sources:
+- https://github.com/helm/charts/stable/fluentd-elasticsearch
+maintainers:
+- name: michelia
+  email: support@rancher.com
+engine: gotpl
diff -uNr packages/logging/charts-original/charts/fluentd/charts/fluentd-windows/templates/daemonset.yaml packages/logging/charts/charts/fluentd/charts/fluentd-windows/templates/daemonset.yaml
--- packages/logging/charts-original/charts/fluentd/charts/fluentd-windows/templates/daemonset.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/charts/fluentd-windows/templates/daemonset.yaml	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,166 @@
+{{- if .Values.enabled -}}
+apiVersion: {{ template "daemonset_api_version" . }}
+kind: DaemonSet
+metadata:
+  name: {{ template "fluentd.fullname" . }}-windows
+  labels:
+    app: {{ template "fluentd.name" . }}
+    chart: {{ template "fluentd.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+{{- if .Values.labels }}
+{{ toYaml .Values.labels | indent 4 }}
+{{- end }}
+spec:
+{{- if .Values.updateStrategy }}
+  updateStrategy:
+{{ toYaml .Values.updateStrategy | indent 4 }}
+{{- end }}
+  selector:
+    matchLabels:
+      app: {{ template "fluentd.name" . }}
+      release: {{ .Release.Name }}
+  template:
+    metadata:
+      labels:
+        app: {{ template "fluentd.name" . }}
+        chart: {{ template "fluentd.version" . }}
+        release: {{ .Release.Name }}
+        heritage: {{ .Release.Service }}
+    {{- if .Values.labels }}
+    {{ toYaml .Values.labels | indent 4 }}
+    {{- end }}
+{{- if .Values.annotations }}
+{{ toYaml .Values.annotations | indent 8 }}
+{{- end }}
+    spec:
+      serviceAccountName: {{ template "fluentd.fullname" . }}
+      initContainers:
+      - name: init-{{ template "fluentd.fullname" . }}
+        image:  {{ template "system_default_registry" . }}{{ .Values.image.repository }}:{{ .Values.image.tag }}
+        command:
+          - 'powershell'
+          - '-command'
+          - 'New-Item -ItemType Directory -Force -Path /var/lib/rancher/fluentd/log'
+        volumeMounts:
+        - mountPath: /var/lib/rancher
+          name: rancher
+      containers:
+      - name: {{ template "fluentd.fullname" . }}
+        image:  {{ template "system_default_registry" . }}{{ .Values.image.repository }}:{{ .Values.image.tag }}
+        imagePullPolicy: {{ .Values.image.pullPolicy | quote }}
+        {{- if .Values.command }}
+        command: {{ .Values.command }}
+        {{ end }}
+        env:
+        {{- range $key, $value := .Values.env }}
+        - name: {{ $key }}
+          value: {{ $value | quote }}
+        {{- end }}
+        - name: K8S_NODE_NAME
+          valueFrom:
+            fieldRef:
+              fieldPath: spec.nodeName
+        resources:
+{{ toYaml .Values.resources | indent 10 }}
+        volumeMounts:
+        - mountPath: /fluentd/etc/config/precan
+          name: config
+        - mountPath: /fluentd/etc/config/entry
+          name: entry
+        - mountPath: /fluentd/etc/config/ssl
+          name: ssl
+        - mountPath: {{ .Values.cluster.dockerRoot }}
+          name: dockerroot
+        - mountPath: /var/log/containers
+          name: varlogcontainers
+        - mountPath: /var/log/pods
+          name: varlogpods
+        - mountPath: /var/lib/rancher/rke/log
+          name: rkelog
+        - mountPath: /fluentd/log
+          name: fluentdlog
+{{- if .Values.extraVolumeMounts }}
+{{ toYaml .Values.extraVolumeMounts | indent 8 }}
+{{- end }}
+        ports:
+{{- range $port := .Values.service.ports }}
+          - name: {{ $port.name }}
+            containerPort: {{ $port.port }}
+{{- if $port.protocol }}
+            protocol: {{ $port.protocol }}
+{{- end }}
+{{- end }}
+{{- if .Values.livenessProbe.enabled }}
+        # use metrics endpoint to monitor liveness
+        livenessProbe:
+          httpGet:
+            path: /metrics
+            port: 24231
+            scheme: HTTP
+          initialDelaySeconds: 60
+          periodSeconds: 60
+          timeoutSeconds: 3
+          failureThreshold: 3
+          successThreshold: 1
+{{- end }}
+      - name: {{ template "fluentd.fullname" . }}-{{ .Values.configmapReload.name }}
+        image: {{ template "system_default_registry" . }}{{ .Values.configmapReload.image.repository }}:{{ .Values.configmapReload.image.tag }}
+        imagePullPolicy: "{{ .Values.configmapReload.image.pullPolicy }}"
+        args:
+          - --volume-dir=/fluentd/etc/config/precan
+          - --volume-dir=/fluentd/etc/config/ssl
+          - --volume-dir=/fluentd/etc/config/entry
+          - --webhook-method=GET
+          - --webhook-url=http://127.0.0.1:24444/api/config.reload
+        resources:
+        {{ toYaml .Values.configmapReload.resources | indent 12 }}
+        volumeMounts:
+          - mountPath: /fluentd/etc/config/precan
+            name: config
+          - mountPath: /fluentd/etc/config/entry
+            name: entry
+          - mountPath: /fluentd/etc/config/ssl
+            name: ssl
+      terminationGracePeriodSeconds: 30
+      volumes:
+      - hostPath:
+          path: {{ .Values.cluster.dockerRoot }}
+        name: dockerroot
+      - hostPath:
+          path: /var/log/containers
+        name: varlogcontainers
+      - hostPath:
+          path: /var/log/pods
+        name: varlogpods
+      - hostPath:
+          path: /var/lib/rancher/rke/log
+        name: rkelog
+      - hostPath:
+          path: /var/lib/rancher/fluentd/log
+        name: fluentdlog
+      - hostPath:
+          path: /var/lib/rancher
+        name: rancher
+      - name: config
+        secret:
+          secretName: {{ template "fluentd.fullname" . }}
+      - name: entry
+        secret:
+          secretName: {{ template "fluentd.fullname" . }}-entry
+      - name: ssl
+        secret:
+          secretName: {{ template "fluentd.fullname" . }}-ssl
+{{- if .Values.extraVolumes }}
+{{ toYaml .Values.extraVolumes | indent 6 }}
+{{- end }}
+      nodeSelector:
+{{- include "windows-node-selector" . | nindent 8 }}
+{{- if .Values.nodeSelector }}
+{{ toYaml .Values.nodeSelector | indent 8 }}
+{{- end }}
+{{- if .Values.tolerations }}
+      tolerations:
+{{ toYaml .Values.tolerations | indent 6 }}
+{{- end }}
+{{- end }}
diff -uNr packages/logging/charts-original/charts/fluentd/charts/fluentd-windows/values.yaml packages/logging/charts/charts/fluentd/charts/fluentd-windows/values.yaml
--- packages/logging/charts-original/charts/fluentd/charts/fluentd-windows/values.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/charts/fluentd-windows/values.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,52 @@
+nameOverride: fluentd
+labels: {}
+
+image:
+  os: windows
+  repository: rancher/fluentd
+  tag: v0.1.19
+  pullPolicy: IfNotPresent
+
+resources: {}
+  # limits:
+  #   cpu: 100m
+  #   memory: 500Mi
+  # requests:
+  #   cpu: 100m
+  #   memory: 200Mi
+# env:
+
+command: '["powershell", "-command",  "fluentd", "-c", "/fluentd/etc/config/entry/fluent.conf"]'
+
+livenessProbe:
+  enabled: true
+
+annotations: {}
+
+# updateStrategy:
+#   type: RollingUpdate
+
+tolerations:
+  - effect: NoSchedule
+    operator: Exists
+
+
+nodeSelector: {}
+
+cluster:
+  dockerRoot: C:\ProgramData\docker
+
+service:
+  ports:
+    - name: metric
+      port: 24231
+      targetPort: metric
+
+configmapReload:
+  name: reloader
+  image:
+    os: windows
+    repository: rancher/configmap-reload
+    tag: v0.3.0-rancher2
+    pullPolicy: IfNotPresent
+  resources: {}
\ No newline at end of file
diff -uNr packages/logging/charts-original/charts/fluentd/Chart.yaml packages/logging/charts/charts/fluentd/Chart.yaml
--- packages/logging/charts-original/charts/fluentd/Chart.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/Chart.yaml	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,16 @@
+name: fluentd
+version: 0.0.2
+appVersion: 1.6.3
+home: https://www.fluentd.org/
+description: A Fluentd Helm chart for Rancher system logging
+icon: https://raw.githubusercontent.com/fluent/fluentd-docs/master/public/logo/Fluentd_square.png
+keywords:
+- fluentd
+- rancher
+- logging
+sources:
+- https://github.com/helm/charts/stable/fluentd-elasticsearch
+maintainers:
+- name: michelia
+  email: support@rancher.com
+engine: gotpl
diff -uNr packages/logging/charts-original/charts/fluentd/requirements.yaml packages/logging/charts/charts/fluentd/requirements.yaml
--- packages/logging/charts-original/charts/fluentd/requirements.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/requirements.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,10 @@
+dependencies:
+  - name: fluentd-linux
+    version: 0.0.2
+    condition: fluentd.fluentd-linux.enabled
+    repository: "file://./charts/fluentd-linux"
+  
+  - name: fluentd-windows
+    version: 0.0.1
+    condition: fluentd.fluentd-windows.enabled
+    repository: "file://./charts/fluentd-windows"
\ No newline at end of file
diff -uNr packages/logging/charts-original/charts/fluentd/templates/_helpers.tpl packages/logging/charts/charts/fluentd/templates/_helpers.tpl
--- packages/logging/charts-original/charts/fluentd/templates/_helpers.tpl	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/templates/_helpers.tpl	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,48 @@
+{{/* vim: set filetype=mustache: */}}
+{{/*
+Expand the name of the chart.
+*/}}
+{{- define "fluentd.name" -}}
+{{- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix "-" -}}
+{{- end -}}
+
+{{/*
+Create a default fully qualified app name.
+We truncate at 63 chars because some Kubernetes name fields are limited to this (by the DNS naming spec).
+If release name contains chart name it will be used as a full name.
+*/}}
+{{- define "fluentd.fullname" -}}
+{{- if .Values.fullnameOverride -}}
+{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" -}}
+{{- else -}}
+{{- $name := default .Chart.Name .Values.nameOverride -}}
+{{- if contains $name .Release.Name -}}
+{{- .Release.Name | trunc 63 | trimSuffix "-" -}}
+{{- else -}}
+{{- printf "%s-%s" .Release.Name $name | trunc 63 | trimSuffix "-" -}}
+{{- end -}}
+{{- end -}}
+{{- end -}}
+{{/*
+Create chart name and version as used by the chart label.
+*/}}
+{{- define "fluentd.chart" -}}
+{{- printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" -}}
+{{- end -}}
+
+{{- define "fluentd.version" -}}
+{{- $name := include "fluentd.name" . -}}
+{{- $version := .Chart.Version | replace "+" "_" -}}
+{{- printf "%s-%s" $name $version -}}
+{{- end -}}
+
+{{/*
+Create the name of the service account to use
+*/}}
+{{- define "fluentd.serviceAccountName" -}}
+{{- if .Values.serviceAccount.create -}}
+    {{ default (include "fluentd.fullname" .) .Values.serviceAccount.name }}
+{{- else -}}
+    {{ default "default" .Values.serviceAccount.name }}
+{{- end -}}
+{{- end -}}
diff -uNr packages/logging/charts-original/charts/fluentd/templates/rbac.yaml packages/logging/charts/charts/fluentd/templates/rbac.yaml
--- packages/logging/charts-original/charts/fluentd/templates/rbac.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/templates/rbac.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,78 @@
+{{- if .Values.rbac.create -}}
+kind: ClusterRole
+apiVersion: {{ template "rbac_api_version" . }}
+metadata:
+  name: {{ template "fluentd.fullname" . }}
+  labels:
+    app: {{ template "fluentd.name" . }}
+    chart: {{ template "fluentd.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+rules:
+- apiGroups:
+  - ""
+  resources:
+  - "namespaces"
+  - "pods"
+  verbs:
+  - "get"
+  - "watch"
+  - "list"
+---
+kind: ClusterRoleBinding
+apiVersion: {{ template "rbac_api_version" . }}
+metadata:
+  name: {{ template "fluentd.fullname" . }}
+  labels:
+    app: {{ template "fluentd.name" . }}
+    chart: {{ template "fluentd.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+subjects:
+- kind: ServiceAccount
+  name: {{ template "fluentd.serviceAccountName" . }}
+  namespace: {{ .Release.Namespace }}
+roleRef:
+  kind: ClusterRole
+  name: {{ template "fluentd.fullname" . }}
+  apiGroup: rbac.authorization.k8s.io
+{{- if .Values.global.podSecurityPolicy.enabled }}
+---
+kind: Role
+apiVersion: {{ template "rbac_api_version" . }}
+metadata:
+  name: {{ template "fluentd.fullname" . }}-psp-role
+  labels:
+    app: {{ template "fluentd.name" . }}
+    chart: {{ template "fluentd.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+rules:
+- apiGroups:
+  - "policy"
+  resources:
+  - "podsecuritypolicies"
+  resourceNames:
+  - {{ .Release.Name }}-psp
+  verbs:
+  - "use"
+---
+kind: RoleBinding
+apiVersion: {{ template "rbac_api_version" . }}
+metadata:
+  name: {{ template "fluentd.fullname" . }}-psp-rolebinding
+  labels:
+    app: {{ template "fluentd.name" . }}
+    chart: {{ template "fluentd.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+subjects:
+- kind: ServiceAccount
+  name: {{ template "fluentd.serviceAccountName" . }}
+  namespace: {{ .Release.Namespace }}
+roleRef:
+  kind: Role
+  name: {{ template "fluentd.fullname" . }}-psp-role
+  apiGroup: rbac.authorization.k8s.io
+{{- end -}}
+{{- end -}}
diff -uNr packages/logging/charts-original/charts/fluentd/templates/secret.yaml packages/logging/charts/charts/fluentd/templates/secret.yaml
--- packages/logging/charts-original/charts/fluentd/templates/secret.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/templates/secret.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,44 @@
+apiVersion: v1
+kind: Secret
+metadata:
+  name: {{ template "fluentd.fullname" . }}
+  labels:
+    app: {{ template "fluentd.name" . }}
+    chart: {{ template "fluentd.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+type: Opaque
+data:
+{{- range $key, $value := .Values.secrets.config }}
+  {{ $key }}: {{ $value | b64enc | quote }}
+{{- end }}
+---
+apiVersion: v1
+kind: Secret
+metadata:
+  name: {{ template "fluentd.fullname" . }}-entry
+  labels:
+    app: {{ template "fluentd.name" . }}-entry
+    chart: {{ template "fluentd.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+    app.kubernetes.io/managed-by: {{ .Release.Service }}
+    kubernetes.io/cluster-service: "true"
+type: Opaque
+data:
+{{- range $key, $value := .Values.secrets.entry }}
+  {{ $key }}: {{ $value | b64enc | quote }}
+{{- end }}
+---
+apiVersion: v1
+kind: Secret
+metadata:
+  name: {{ template "fluentd.fullname" . }}-ssl
+  labels:
+    app: {{ template "fluentd.name" . }}-ssl
+    chart: {{ template "fluentd.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+    app.kubernetes.io/managed-by: {{ .Release.Service }}
+    kubernetes.io/cluster-service: "true"
+type: Opaque
\ No newline at end of file
diff -uNr packages/logging/charts-original/charts/fluentd/templates/service-account.yaml packages/logging/charts/charts/fluentd/templates/service-account.yaml
--- packages/logging/charts-original/charts/fluentd/templates/service-account.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/templates/service-account.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,11 @@
+{{- if .Values.serviceAccount.create -}}
+apiVersion: v1
+kind: ServiceAccount
+metadata:
+  name: {{ template "fluentd.fullname" . }}
+  labels:
+    app: {{ template "fluentd.name" . }}
+    chart: {{ template "fluentd.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+{{- end -}}
diff -uNr packages/logging/charts-original/charts/fluentd/templates/service.yaml packages/logging/charts/charts/fluentd/templates/service.yaml
--- packages/logging/charts-original/charts/fluentd/templates/service.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/templates/service.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,28 @@
+{{- if .Values.service }}
+apiVersion: v1
+kind: Service
+metadata:
+  name: {{ template "fluentd.fullname" . }}
+  labels:
+    app: {{ template "fluentd.name" . }}
+    chart: {{ template "fluentd.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+spec:
+  type: {{ .Values.service.type }}
+  ports:
+  {{- range $port := .Values.service.ports }}
+    - name: {{ $port.name }}
+      port: {{ $port.port }}
+      targetPort: {{ $port.port }}
+      {{- if $port.nodePort }}
+      nodePort: {{ $port.nodePort }}
+      {{- end }}
+      {{- if $port.protocol }}
+      protocol: {{ $port.protocol }}
+      {{- end }}
+  {{- end }}
+  selector:
+    app: {{ template "fluentd.name" . }}
+    chart: {{ template "fluentd.version" . }}
+{{- end }}
diff -uNr packages/logging/charts-original/charts/fluentd/values.yaml packages/logging/charts/charts/fluentd/values.yaml
--- packages/logging/charts-original/charts/fluentd/values.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd/values.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,401 @@
+fluentd-linux:
+  enabled: true
+
+fluentd-windows:
+  enabled: false
+
+nameOverride: fluentd
+
+rbac:
+  create: true
+
+serviceAccount:
+  create: true
+
+service:
+  type: ClusterIP
+  ports:
+    - name: metric
+      port: 24231
+      targetPort: metric
+
+secrets:
+  entry:
+    fluent.conf: |-
+      @include /fluentd/etc/config/precan/*.conf
+
+      @include /fluentd/etc/config/custom/project/*.conf
+      @include /fluentd/etc/config/custom/cluster/*.conf
+  config:
+    system.conf: |-
+      <source>
+        @type prometheus
+        bind 0.0.0.0
+        port 24231
+        metrics_path /metrics
+      </source>
+
+      <source>
+        @type prometheus_output_monitor
+        interval 10
+        <labels>
+          pod_name ${hostname}
+        </labels>
+      </source>
+
+      <system>
+        rpc_endpoint 127.0.0.1:24444
+      </system>
+    custom_cluster.conf: |-
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/*/apache2/*/*
+        pos_file /fluentd/log/custom_cluster_apache2_new.log.pos
+        tag tmp-cluster-custom.*
+        format /^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)?$/ 
+        time_format %d/%b/%Y:%H:%M:%S %z
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/*/nginx/*/* 
+        pos_file /fluentd/log/custom_cluster_nginx_new.log.pos
+        tag tmp-cluster-custom.*
+        format /^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^\"]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)") (?<gzip_ratio>[^ ]*)?$/
+        time_format %d/%b/%Y:%H:%M:%S %z
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/*/rfc3164/*/*
+        pos_file /fluentd/log/custom_cluster_rfc3164_new.log.pos
+        tag tmp-cluster-custom.*
+        format /^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$/
+        time_format "%b %d %H:%M:%S"
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/*/rfc5424/*/*
+        pos_file /fluentd/log/custom_cluster_rfc5424_new.log.pos
+        tag tmp-cluster-custom.*
+        format /\A^\<(?<pri>[0-9]{1,3})\>[1-9]\d{0,2} (?<time>[^ ]+) (?<host>[^ ]+) (?<ident>[^ ]+) (?<pid>[-0-9]+) (?<msgid>[^ ]+) (?<extradata>(\[(.*)\]|[^ ])) (?<message>.+)$\z/
+        time_format "%Y-%m-%dT%H:%M:%S.%L%z"
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/*/json/*/*
+        pos_file /fluentd/log/custom_cluster_json_new.log.pos
+        tag tmp-cluster-custom.*
+        format json
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/*/none/*/*
+        pos_file /fluentd/log/custom_cluster_none_new.log.pos
+        tag tmp-cluster-custom.*
+        <parse>
+          @type none
+          message_key log
+        </parse>
+      </source>
+
+      <filter tmp-cluster-custom.**>
+        @type record_transformer
+        enable_ruby true  
+        <record>
+          tag ${tag}
+          cluster_id ${component = tag.match(Regexp.compile('tmp-cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<pod_id>[^_]+)_(?<volume_name>[^_]+)\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])+)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['cluster_id']}
+          cluster_name ${component = tag.match(Regexp.compile('tmp-cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<pod_id>[^_]+)_(?<volume_name>[^_]+)\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])+)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['cluster_name']}
+          project_id ${component = tag.match(Regexp.compile('tmp-cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<pod_id>[^_]+)_(?<volume_name>[^_]+)\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])+)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['project_id']}
+          project_name ${component = tag.match(Regexp.compile('tmp-cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<pod_id>[^_]+)_(?<volume_name>[^_]+)\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])+)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['project_name'].gsub('~', '_')}
+          workload_name ${component = tag.match(Regexp.compile('tmp-cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<pod_id>[^_]+)_(?<volume_name>[^_]+)\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])+)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['workload_name']}
+          volume_name ${component = tag.match(Regexp.compile('tmp-cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<pod_id>[^_]+)_(?<volume_name>[^_]+)\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])+)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['volume_name']}
+          filename ${component = tag.match(Regexp.compile('tmp-cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<pod_id>[^_]+)_(?<volume_name>[^_]+)\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])+)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['filename']}
+          format ${component = tag.match(Regexp.compile('tmp-cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<pod_id>[^_]+)_(?<volume_name>[^_]+)\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])+)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['format']}
+        </record>
+      </filter>
+
+      <match tmp-cluster-custom.**>
+        @type rewrite_tag_filter
+        <rule>
+          key     tag
+          pattern tmp-cluster-custom\.var\.lib\.rancher\.log-volumes\.((?<pod_id>[^_]+)_(?<volume_name>[^_]+))\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])*)_(?<container_name>[^_^.]+)\.(?<filename>.+)
+          tag     tmp1.cluster-custom.$10_$6_$10_$11
+        </rule>
+      </match>
+
+      <filter tmp1.cluster-custom.**>
+        @type kubernetes_metadata 
+        tag_to_kubernetes_name_regexp tmp1\.cluster-custom\.(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*)_(?<namespace>[^_]+)_(?<docker_id>.+)_(?<container_name>.+)$
+      </filter>
+
+      <match tmp1.cluster-custom.**>
+        @type rewrite_tag_filter
+        remove_tag_prefix tmp1
+        <rule>
+          key     tag
+          pattern tmp-cluster-custom\.var\.lib\.rancher\.log-volumes\.((?<pod_id>[^_]+)_(?<volume_name>[^_]+))\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])*)_(?<container_name>[^_^.]+)\.(?<filename>.+)
+          tag     cluster-custom
+        </rule>
+      </match>
+
+      <filter cluster-custom.**>
+        @type record_transformer
+        enable_ruby
+        remove_keys tag
+      </filter>
+    custom_project.conf: |-
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/*/apache2/*/*
+        pos_file /fluentd/log/custom_project_apache2_new.log.pos
+        tag tmp-project-custom.*
+        format /^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)?$/ 
+        time_format %d/%b/%Y:%H:%M:%S %z
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/*/nginx/*/* 
+        pos_file /fluentd/log/custom_project_nginx_new.log.pos
+        tag tmp-project-custom.*
+        format /^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^\"]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)") (?<gzip_ratio>[^ ]*)?$/
+        time_format %d/%b/%Y:%H:%M:%S %z
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/*/rfc3164/*/*
+        pos_file /fluentd/log/custom_project_rfc3164_new.log.pos
+        tag tmp-project-custom.*
+        format /^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$/
+        time_format "%b %d %H:%M:%S"
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/*/rfc5424/*/*
+        pos_file /fluentd/log/custom_project_rfc5424_new.log.pos
+        tag tmp-project-custom.*
+        format /\A^\<(?<pri>[0-9]{1,3})\>[1-9]\d{0,2} (?<time>[^ ]+) (?<host>[^ ]+) (?<ident>[^ ]+) (?<pid>[-0-9]+) (?<msgid>[^ ]+) (?<extradata>(\[(.*)\]|[^ ])) (?<message>.+)$\z/
+        time_format "%Y-%m-%dT%H:%M:%S.%L%z"
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/*/json/*/*
+        pos_file /fluentd/log/custom_project_json_new.log.pos
+        tag tmp-project-custom.*
+        format json
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/*/none/*/*
+        pos_file /fluentd/log/custom_project_none_new.log.pos
+        tag tmp-project-custom.*
+        <parse>
+          @type none
+          message_key log
+        </parse>
+      </source>
+
+      <filter tmp-project-custom.**>
+        @type record_transformer
+        enable_ruby true  
+        <record>
+          tag ${tag}
+          cluster_id ${component = tag.match(Regexp.compile('tmp-project-custom\.var\.lib\.rancher\.log-volumes\.((?<pod_id>[^_]+)_(?<volume_name>[^_]+))\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])*)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['cluster_id']}
+          cluster_name ${component = tag.match(Regexp.compile('tmp-project-custom\.var\.lib\.rancher\.log-volumes\.((?<pod_id>[^_]+)_(?<volume_name>[^_]+))\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])*)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['cluster_name']}
+          project_id ${component = tag.match(Regexp.compile('tmp-project-custom\.var\.lib\.rancher\.log-volumes\.((?<pod_id>[^_]+)_(?<volume_name>[^_]+))\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])*)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['project_id']}
+          project_name ${component = tag.match(Regexp.compile('tmp-project-custom\.var\.lib\.rancher\.log-volumes\.((?<pod_id>[^_]+)_(?<volume_name>[^_]+))\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])*)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['project_name'].gsub('~', '_')}
+          workload_name ${component = tag.match(Regexp.compile('tmp-project-custom\.var\.lib\.rancher\.log-volumes\.((?<pod_id>[^_]+)_(?<volume_name>[^_]+))\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])*)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['workload_name']}
+          volume_name ${component = tag.match(Regexp.compile('tmp-project-custom\.var\.lib\.rancher\.log-volumes\.((?<pod_id>[^_]+)_(?<volume_name>[^_]+))\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])*)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['volume_name']}
+          filename ${component = tag.match(Regexp.compile('tmp-project-custom\.var\.lib\.rancher\.log-volumes\.((?<pod_id>[^_]+)_(?<volume_name>[^_]+))\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])*)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['filename']}
+          format ${component = tag.match(Regexp.compile('tmp-project-custom\.var\.lib\.rancher\.log-volumes\.((?<pod_id>[^_]+)_(?<volume_name>[^_]+))\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])*)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); component['format']}
+          cluster_project ${component = tag.match(Regexp.compile('tmp-project-custom\.var\.lib\.rancher\.log-volumes\.((?<pod_id>[^_]+)_(?<volume_name>[^_]+))\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])*)_(?<container_name>[^_^.]+)\.(?<filename>.+)')); "#{component['cluster_id']}:#{component['project_id']}"}
+        </record>
+      </filter>
+
+      <match tmp-project-custom.**>
+        @type rewrite_tag_filter
+        <rule>
+          key     tag
+          pattern tmp-project-custom\.var\.lib\.rancher\.log-volumes\.((?<pod_id>[^_]+)_(?<volume_name>[^_]+))\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])*)_(?<container_name>[^_^.]+)\.(?<filename>.+)
+          tag     tmp1.tmp2-project-custom.$10_$6_$10_$11
+        </rule>
+      </match>
+
+      <filter tmp1.tmp2-project-custom.**>
+        @type kubernetes_metadata 
+        tag_to_kubernetes_name_regexp tmp1\.tmp2-project-custom\.(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*)_(?<namespace>[^_]+)_(?<docker_id>.+)_(?<container_name>.+)$
+      </filter>
+
+      <match tmp1.tmp2-project-custom.**>
+        @type rewrite_tag_filter
+        remove_tag_prefix tmp1
+        <rule>
+          key     tag
+          pattern tmp-project-custom\.var\.lib\.rancher\.log-volumes\.((?<pod_id>[^_]+)_(?<volume_name>[^_]+))\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<pod_name>[a-z0-9]([-a-z0-9]*[a-z0-9])*)_(?<container_name>[^_^.]+)\.(?<filename>.+)
+          tag     tmp2-project-custom
+        </rule>
+      </match>
+
+      <match tmp2-project-custom.**>
+        @type rewrite_tag_filter
+        <rule>
+          key cluster_project
+          pattern (?<cluster_project>.+\:.+)
+          tag project-custom.$1
+        </rule>
+      </match>
+
+      <filter project-custom.**>
+        @type record_transformer
+        enable_ruby
+        remove_keys docker,tag
+      </filter>
+    legacy_custom_cluster.conf: |-
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/apache2/*/*
+        pos_file /fluentd/log/custom_cluster_apache2.log.pos
+        tag tmp2.cluster-custom.*
+        format /^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)?$/ 
+        time_format %d/%b/%Y:%H:%M:%S %z
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/nginx/*/* 
+        pos_file /fluentd/log/custom_cluster_nginx.log.pos
+        tag tmp2.cluster-custom.*
+        format /^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^\"]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)") (?<gzip_ratio>[^ ]*)?$/
+        time_format %d/%b/%Y:%H:%M:%S %z
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/rfc3164/*/*
+        pos_file /fluentd/log/custom_cluster_rfc3164.log.pos
+        tag tmp2.cluster-custom.*
+        format /^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$/
+        time_format "%b %d %H:%M:%S"
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/rfc5424/*/*
+        pos_file /fluentd/log/custom_cluster_rfc5424.log.pos
+        tag tmp2.cluster-custom.*
+        format /\A^\<(?<pri>[0-9]{1,3})\>[1-9]\d{0,2} (?<time>[^ ]+) (?<host>[^ ]+) (?<ident>[^ ]+) (?<pid>[-0-9]+) (?<msgid>[^ ]+) (?<extradata>(\[(.*)\]|[^ ])) (?<message>.+)$\z/
+        time_format "%Y-%m-%dT%H:%M:%S.%L%z"
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/json/*/*
+        pos_file /fluentd/log/custom_cluster_json.log.pos
+        tag tmp2.cluster-custom.*
+        format json
+      </source>
+
+      <filter tmp2.cluster-custom.**>
+        @type record_transformer
+        enable_ruby true  
+        <record>
+          tag ${tag}    
+          cluster_id ${component = tag.match(Regexp.compile('tmp2\.cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$'));component['cluster_id']}
+          cluster_name ${component = tag.match(Regexp.compile('tmp2\.cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['cluster_name']}
+          project_id ${component = tag.match(Regexp.compile('tmp2\.cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['project_id']}
+          project_name ${component = tag.match(Regexp.compile('tmp2\.cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['project_name'].gsub('~', '_')}
+          workload_name ${component = tag.match(Regexp.compile('tmp2\.cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['workload_name']}
+          volume_name ${component = tag.match(Regexp.compile('tmp2\.cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['volume_name']}
+          filename ${component = tag.match(Regexp.compile('tmp2\.cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['filename']}
+          format ${component = tag.match(Regexp.compile('tmp2\.cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['format']}
+        </record>
+      </filter>
+
+      <match tmp2.cluster-custom.**>
+        @type rewrite_tag_filter
+        remove_tag_prefix tmp2
+        <rule>
+          key     tag
+          pattern tmp2\.cluster-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$
+          tag     cluster-custom
+        </rule>
+      </match>
+    legacy_custom_project.conf: |-
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/apache2/*/*
+        pos_file /fluentd/log/custom_project_apache2.log.pos
+        tag tmp2.tmp2-project-custom.*
+        format /^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)?$/ 
+        time_format %d/%b/%Y:%H:%M:%S %z
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/nginx/*/* 
+        pos_file /fluentd/log/custom_project_nginx.log.pos
+        tag tmp2.tmp2-project-custom.*
+        format /^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^\"]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)") (?<gzip_ratio>[^ ]*)?$/
+        time_format %d/%b/%Y:%H:%M:%S %z
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/rfc3164/*/*
+        pos_file /fluentd/log/custom_project_rfc3164.log.pos
+        tag tmp2.tmp2-project-custom.*
+        format /^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$/
+        time_format "%b %d %H:%M:%S"
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/rfc5424/*/*
+        pos_file /fluentd/log/custom_project_rfc5424.log.pos
+        tag tmp2.tmp2-project-custom.*
+        format /\A^\<(?<pri>[0-9]{1,3})\>[1-9]\d{0,2} (?<time>[^ ]+) (?<host>[^ ]+) (?<ident>[^ ]+) (?<pid>[-0-9]+) (?<msgid>[^ ]+) (?<extradata>(\[(.*)\]|[^ ])) (?<message>.+)$\z/
+        time_format "%Y-%m-%dT%H:%M:%S.%L%z"
+      </source>
+
+      <source>
+        @type tail
+        path /var/lib/rancher/log-volumes/json/*/*
+        pos_file /fluentd/log/custom_project_json.log.pos
+        tag tmp2.tmp2-project-custom.*
+        format json
+      </source>
+
+      <filter tmp2.tmp2-project-custom.**>
+        @type record_transformer
+        enable_ruby true  
+        <record>
+          tag ${tag}        
+          cluster_id ${component = tag.match(Regexp.compile('tmp2\.tmp2-project-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>.+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['cluster_id']}
+          cluster_name ${component = tag.match(Regexp.compile('tmp2\.tmp2-project-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>.+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['cluster_name']}
+          project_id ${component = tag.match(Regexp.compile('tmp2\.tmp2-project-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>.+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['project_id']}
+          project_name ${component = tag.match(Regexp.compile('tmp2\.tmp2-project-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>.+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['project_name']}
+          workload_name ${component = tag.match(Regexp.compile('tmp2\.tmp2-project-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>.+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['workload_name']}
+          volume_name ${component = tag.match(Regexp.compile('tmp2\.tmp2-project-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>.+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['volume_name']}
+          filename ${component = tag.match(Regexp.compile('tmp2\.tmp2-project-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>.+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['filename']}
+          format ${component = tag.match(Regexp.compile('tmp2\.tmp2-project-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>.+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); component['format']}
+          cluster_project ${component = tag.match(Regexp.compile('tmp2\.tmp2-project-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>.+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$')); "#{component['cluster_id']}:#{component['project_id']}"}
+        </record>
+      </filter>
+
+      <match tmp2.tmp2-project-custom.**>
+        @type rewrite_tag_filter
+        remove_tag_prefix tmp2
+        <rule>
+          key     tag
+          pattern tmp2\.tmp2-project-custom\.var\.lib\.rancher\.log-volumes\.(?<format>[a-z0-9]+)\.(?<cluster_id>[^_]+)_(?<cluster_name>[^_]+)_(?<namespace>[^_]+)_(?<project_id>[^_]+)_(?<project_name>[^_]+)_(?<workload_name>[^_]+)_(?<container_name>[^_]+)_(?<volume_name>[^_^.]+)\.(?<filename>.+)$
+          tag     tmp2-project-custom
+        </rule>
+      </match>
\ No newline at end of file
diff -uNr packages/logging/charts-original/charts/fluentd-tester/Chart.yaml packages/logging/charts/charts/fluentd-tester/Chart.yaml
--- packages/logging/charts-original/charts/fluentd-tester/Chart.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd-tester/Chart.yaml	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,16 @@
+name: fluentd-tester
+version: 0.0.2
+appVersion: 1.6.3
+home: https://www.fluentd.org/
+description: A Fluentd Test Helm chart for validate fluentd config
+icon: https://raw.githubusercontent.com/fluent/fluentd-docs/master/public/logo/Fluentd_square.png
+keywords:
+- fluentd
+- rancher
+- logging
+sources:
+- https://github.com/helm/charts/stable/fluentd-elasticsearch
+maintainers:
+- name: michelia
+  email: support@rancher.com
+engine: gotpl
diff -uNr packages/logging/charts-original/charts/fluentd-tester/templates/clusterrolebinding.yaml packages/logging/charts/charts/fluentd-tester/templates/clusterrolebinding.yaml
--- packages/logging/charts-original/charts/fluentd-tester/templates/clusterrolebinding.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd-tester/templates/clusterrolebinding.yaml	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,19 @@
+{{- if .Values.rbac.create -}}
+kind: ClusterRoleBinding
+apiVersion: {{ template "rbac_api_version" . }}
+metadata:
+  name: {{ template "fluentd-tester.fullname" . }}
+  labels:
+    app: {{ template "fluentd-tester.name" . }}
+    chart: {{ template "fluentd-tester.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+subjects:
+- kind: ServiceAccount
+  name: {{ template "fluentd-tester.serviceAccountName" . }}
+  namespace: {{ .Release.Namespace }}
+roleRef:
+  kind: ClusterRole
+  name: {{ template "fluentd-tester.fullname" . }}
+  apiGroup: rbac.authorization.k8s.io
+{{- end -}}
diff -uNr packages/logging/charts-original/charts/fluentd-tester/templates/clusterrole.yaml packages/logging/charts/charts/fluentd-tester/templates/clusterrole.yaml
--- packages/logging/charts-original/charts/fluentd-tester/templates/clusterrole.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd-tester/templates/clusterrole.yaml	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,21 @@
+{{- if .Values.rbac.create -}}
+kind: ClusterRole
+apiVersion: {{ template "rbac_api_version" . }}
+metadata:
+  name: {{ template "fluentd-tester.fullname" . }}
+  labels:
+    app: {{ template "fluentd-tester.name" . }}
+    chart: {{ template "fluentd-tester.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+rules:
+- apiGroups:
+  - ""
+  resources:
+  - "namespaces"
+  - "pods"
+  verbs:
+  - "get"
+  - "watch"
+  - "list"
+{{- end -}}
\ No newline at end of file
diff -uNr packages/logging/charts-original/charts/fluentd-tester/templates/deployment.yaml packages/logging/charts/charts/fluentd-tester/templates/deployment.yaml
--- packages/logging/charts-original/charts/fluentd-tester/templates/deployment.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd-tester/templates/deployment.yaml	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,79 @@
+apiVersion: {{ template "deployment_api_version" . }}
+kind: Deployment
+metadata:
+  name: {{ template "fluentd-tester.fullname" . }}
+  labels:
+    app: {{ template "fluentd-tester.name" . }}
+    chart: {{ template "fluentd-tester.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+{{- if .Values.labels }}
+{{ toYaml .Values.labels | indent 4 }}
+{{- end }}
+spec:
+{{- if .Values.updateStrategy }}
+  updateStrategy:
+{{ toYaml .Values.updateStrategy | indent 4 }}
+{{- end }}
+  selector:
+    matchLabels:
+      app: {{ template "fluentd-tester.name" . }}
+      release: {{ .Release.Name }}
+  template:
+    metadata:
+      labels:
+        app: {{ template "fluentd-tester.name" . }}
+        chart: {{ template "fluentd-tester.version" . }}
+        release: {{ .Release.Name }}
+        heritage: {{ .Release.Service }}
+    {{- if .Values.labels }}
+    {{ toYaml .Values.labels | indent 4 }}
+    {{- end }}
+{{- if .Values.annotations }}
+{{ toYaml .Values.annotations | indent 8 }}
+{{- end }}
+    spec:
+      serviceAccountName: {{ template "fluentd-tester.fullname" . }}
+      containers:
+      - name: "dry-run"
+        image: {{ template "system_default_registry" . }}{{ .Values.image.repository }}:{{ .Values.image.tag }}
+        imagePullPolicy: {{ .Values.image.pullPolicy | quote }}
+        {{- if .Values.command }}
+        command: {{ .Values.command }}
+        {{ end }}
+        env:
+        {{- range $key, $value := .Values.env }}
+        - name: {{ $key }}
+          value: {{ $value | quote }}
+        {{- end }}
+        - name: K8S_NODE_NAME
+          valueFrom:
+            fieldRef:
+              fieldPath: spec.nodeName
+        resources:
+{{ toYaml .Values.resources | indent 10 }}
+{{- if .Values.extraVolumeMounts }}
+{{ toYaml .Values.extraVolumeMounts | indent 8 }}
+{{- end }}
+{{- if .Values.service }}
+        ports:
+{{- range $port := .Values.service.ports }}
+          - name: {{ $port.name }}
+            containerPort: {{ $port.port }}
+{{- if $port.protocol }}
+            protocol: {{ $port.protocol }}
+{{- end }}
+{{- end }}
+{{- end }}
+{{- if .Values.extraVolumes }}
+{{ toYaml .Values.extraVolumes | indent 6 }}
+{{- end }}
+      nodeSelector:
+{{- include "linux-node-selector" . | nindent 8 }}
+{{- if .Values.nodeSelector }}
+{{ toYaml .Values.nodeSelector | indent 8 }}
+{{- end }}
+{{- if .Values.tolerations }}
+      tolerations:
+{{ toYaml .Values.tolerations | indent 6 }}
+{{- end }}
diff -uNr packages/logging/charts-original/charts/fluentd-tester/templates/_helpers.tpl packages/logging/charts/charts/fluentd-tester/templates/_helpers.tpl
--- packages/logging/charts-original/charts/fluentd-tester/templates/_helpers.tpl	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd-tester/templates/_helpers.tpl	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,48 @@
+{{/* vim: set filetype=mustache: */}}
+{{/*
+Expand the name of the chart.
+*/}}
+{{- define "fluentd-tester.name" -}}
+{{- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix "-" -}}
+{{- end -}}
+
+{{/*
+Create a default fully qualified app name.
+We truncate at 63 chars because some Kubernetes name fields are limited to this (by the DNS naming spec).
+If release name contains chart name it will be used as a full name.
+*/}}
+{{- define "fluentd-tester.fullname" -}}
+{{- if .Values.fullnameOverride -}}
+{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" -}}
+{{- else -}}
+{{- $name := default .Chart.Name .Values.nameOverride -}}
+{{- if contains $name .Release.Name -}}
+{{- .Release.Name | trunc 63 | trimSuffix "-" -}}
+{{- else -}}
+{{- printf "%s-%s" .Release.Name $name | trunc 63 | trimSuffix "-" -}}
+{{- end -}}
+{{- end -}}
+{{- end -}}
+{{/*
+Create chart name and version as used by the chart label.
+*/}}
+{{- define "fluentd-tester.chart" -}}
+{{- printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" -}}
+{{- end -}}
+
+{{- define "fluentd-tester.version" -}}
+{{- $name := include "fluentd-tester.name" . -}}
+{{- $version := .Chart.Version | replace "+" "_" -}}
+{{- printf "%s-%s" $name $version -}}
+{{- end -}}
+
+{{/*
+Create the name of the service account to use
+*/}}
+{{- define "fluentd-tester.serviceAccountName" -}}
+{{- if .Values.serviceAccount.create -}}
+    {{ default (include "fluentd-tester.fullname" .) .Values.serviceAccount.name }}
+{{- else -}}
+    {{ default "default" .Values.serviceAccount.name }}
+{{- end -}}
+{{- end -}}
diff -uNr packages/logging/charts-original/charts/fluentd-tester/templates/service-account.yaml packages/logging/charts/charts/fluentd-tester/templates/service-account.yaml
--- packages/logging/charts-original/charts/fluentd-tester/templates/service-account.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd-tester/templates/service-account.yaml	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,11 @@
+{{- if .Values.serviceAccount.create -}}
+apiVersion: v1
+kind: ServiceAccount
+metadata:
+  name: {{ template "fluentd-tester.fullname" . }}
+  labels:
+    app: {{ template "fluentd-tester.name" . }}
+    chart: {{ template "fluentd-tester.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+{{- end -}}
diff -uNr packages/logging/charts-original/charts/fluentd-tester/values.yaml packages/logging/charts/charts/fluentd-tester/values.yaml
--- packages/logging/charts-original/charts/fluentd-tester/values.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/fluentd-tester/values.yaml	2020-04-09 23:55:05.696024100 -0700
@@ -0,0 +1,34 @@
+labels: {}
+
+image:
+  repository: rancher/fluentd
+  tag: v0.1.19
+  pullPolicy: IfNotPresent
+
+resources: {}
+  # limits:
+  #   cpu: 100m
+  #   memory: 500Mi
+  # requests:
+  #   cpu: 100m
+  #   memory: 200Mi
+# env:
+
+command: '["sh", "-c", "tail -f /dev/null"]'
+
+rbac:
+  create: true
+
+serviceAccount:
+  create: true
+
+annotations: {}
+
+# updateStrategy:
+#   type: RollingUpdate
+
+tolerations:
+  - effect: NoSchedule
+    operator: Exists
+
+nodeSelector: {}
\ No newline at end of file
diff -uNr packages/logging/charts-original/charts/log-aggregator/charts/log-aggregator-linux/Chart.yaml packages/logging/charts/charts/log-aggregator/charts/log-aggregator-linux/Chart.yaml
--- packages/logging/charts-original/charts/log-aggregator/charts/log-aggregator-linux/Chart.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/log-aggregator/charts/log-aggregator-linux/Chart.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,15 @@
+name: log-aggregator-linux
+version: 0.0.1
+appVersion: 0.1.5
+home: https://github.com/rancher/log-aggregator
+description: Deploy flexvolume driver log-aggregator to collect log.
+icon: https://raw.githubusercontent.com/fluent/fluentd-docs/master/public/logo/Fluentd_square.png
+keywords:
+- fluentd
+- flexvolume driver
+- logging
+- linux
+maintainers:
+- name: michelia
+  email: support@rancher.com
+engine: gotpl
diff -uNr packages/logging/charts-original/charts/log-aggregator/charts/log-aggregator-linux/templates/daemonset.yaml packages/logging/charts/charts/log-aggregator/charts/log-aggregator-linux/templates/daemonset.yaml
--- packages/logging/charts-original/charts/log-aggregator/charts/log-aggregator-linux/templates/daemonset.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/log-aggregator/charts/log-aggregator-linux/templates/daemonset.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,60 @@
+apiVersion: {{ template "daemonset_api_version" . }}
+kind: DaemonSet
+metadata:
+  name: {{ template "log-aggregator.fullname" . }}-linux
+  labels:
+    app: {{ template "log-aggregator.name" . }}
+    chart: {{ template "log-aggregator.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+{{- if .Values.labels }}
+{{ toYaml .Values.labels | indent 4 }}
+{{- end }}
+spec:
+{{- if .Values.updateStrategy }}
+  updateStrategy:
+{{ toYaml .Values.updateStrategy | indent 4 }}
+{{- end }}
+  selector:
+    matchLabels:
+      app: {{ template "log-aggregator.name" . }}
+      release: {{ .Release.Name }}
+  template:
+    metadata:
+      labels:
+        app: {{ template "log-aggregator.name" . }}
+        chart: {{ template "log-aggregator.version" . }}
+        release: {{ .Release.Name }}
+    spec:
+      serviceAccountName: {{ template "log-aggregator.fullname" . }}
+      containers:
+      - name: log-aggregator
+        image: {{ template "system_default_registry" . }}{{ .Values.image.repository }}:{{ .Values.image.tag }}
+        imagePullPolicy: "{{ .Values.image.pullPolicy }}"
+{{- if .Values.global.privileged }}
+        securityContext:
+          privileged: true
+{{- end }}
+        volumeMounts:
+        - name: flexvolume-driver
+          mountPath: /flexmnt
+{{- if .Values.env }}
+        env:
+{{ toYaml .Values.env | indent 10 }}
+{{- end }}
+        resources:
+{{ toYaml .Values.resources | indent 10 }}
+      terminationGracePeriodSeconds: 10
+      nodeSelector:
+{{- include "linux-node-selector" . | nindent 8 }}
+    {{- if .Values.nodeSelector }}
+{{ toYaml .Values.nodeSelector | indent 8 }}
+    {{- end }}
+      tolerations:
+    {{- if .Values.tolerations }}
+{{ toYaml .Values.tolerations | indent 8 }}
+    {{- end }}
+      volumes:
+      - name: flexvolume-driver
+        hostPath:
+          path: {{ .Values.flexVolumeDir }}
diff -uNr packages/logging/charts-original/charts/log-aggregator/charts/log-aggregator-linux/values.yaml packages/logging/charts/charts/log-aggregator/charts/log-aggregator-linux/values.yaml
--- packages/logging/charts-original/charts/log-aggregator/charts/log-aggregator-linux/values.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/log-aggregator/charts/log-aggregator-linux/values.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,27 @@
+nameOverride: log-aggregator
+
+labels: {}
+## Log Aggregator container image
+##
+image:
+  repository: rancher/log-aggregator
+  tag: v0.1.6
+
+nodeSelector: {}
+
+# updateStrategy:
+#   type: RollingUpdate
+
+tolerations:
+  - effect: NoSchedule
+    operator: Exists
+
+## Resource limits & requests
+## Ref: https://kubernetes.io/docs/user-guide/compute-resources/
+##
+resources: {}
+  # requests:
+  #   memory: 400Mi
+
+## flexvolume dir
+flexVolumeDir: /usr/libexec/kubernetes/kubelet-plugins/volume/exec
diff -uNr packages/logging/charts-original/charts/log-aggregator/charts/log-aggregator-windows/Chart.yaml packages/logging/charts/charts/log-aggregator/charts/log-aggregator-windows/Chart.yaml
--- packages/logging/charts-original/charts/log-aggregator/charts/log-aggregator-windows/Chart.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/log-aggregator/charts/log-aggregator-windows/Chart.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,15 @@
+name: log-aggregator-windows
+version: 0.0.1
+appVersion: 0.1.5
+home: https://github.com/rancher/log-aggregator
+description: Deploy flexvolume driver log-aggregator to collect log.
+icon: https://raw.githubusercontent.com/fluent/fluentd-docs/master/public/logo/Fluentd_square.png
+keywords:
+- fluentd
+- flexvolume driver
+- logging
+- windows
+maintainers:
+- name: michelia
+  email: support@rancher.com
+engine: gotpl
diff -uNr packages/logging/charts-original/charts/log-aggregator/charts/log-aggregator-windows/templates/daemonset.yaml packages/logging/charts/charts/log-aggregator/charts/log-aggregator-windows/templates/daemonset.yaml
--- packages/logging/charts-original/charts/log-aggregator/charts/log-aggregator-windows/templates/daemonset.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/log-aggregator/charts/log-aggregator-windows/templates/daemonset.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,58 @@
+{{- if .Values.enabled -}}
+apiVersion: {{ template "daemonset_api_version" . }}
+kind: DaemonSet
+metadata:
+  name: {{ template "log-aggregator.fullname" . }}-windows
+  labels:
+    app: {{ template "log-aggregator.name" . }}
+    chart: {{ template "log-aggregator.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+{{- if .Values.labels }}
+{{ toYaml .Values.labels | indent 4 }}
+{{- end }}
+spec:
+{{- if .Values.updateStrategy }}
+  updateStrategy:
+{{ toYaml .Values.updateStrategy | indent 4 }}
+{{- end }}
+  selector:
+    matchLabels:
+      app: {{ template "log-aggregator.name" . }}
+      release: {{ .Release.Name }}
+  template:
+    metadata:
+      labels:
+        app: {{ template "log-aggregator.name" . }}
+        chart: {{ template "log-aggregator.version" . }}
+        release: {{ .Release.Name }}
+    spec:
+      serviceAccountName: {{ template "log-aggregator.fullname" . }}
+      containers:
+      - name: log-aggregator
+        image: {{ template "system_default_registry" . }}{{ .Values.image.repository }}:{{ .Values.image.tag }}
+        imagePullPolicy: "{{ .Values.image.pullPolicy }}"
+        volumeMounts:
+        - name: flexvolume-driver
+          mountPath: /flexmnt
+{{- if .Values.env }}
+        env:
+{{ toYaml .Values.env | indent 10 }}
+{{- end }}
+        resources:
+{{ toYaml .Values.resources | indent 10 }}
+      terminationGracePeriodSeconds: 10
+      nodeSelector:
+{{- include "windows-node-selector" . | nindent 8 }}
+    {{- if .Values.nodeSelector }}
+{{ toYaml .Values.nodeSelector | indent 8 }}
+    {{- end }}
+      tolerations:
+    {{- if .Values.tolerations }}
+{{ toYaml .Values.tolerations | indent 8 }}
+    {{- end }}
+      volumes:
+      - name: flexvolume-driver
+        hostPath:
+          path: {{ .Values.flexVolumeDir }}
+{{- end }}
\ No newline at end of file
diff -uNr packages/logging/charts-original/charts/log-aggregator/charts/log-aggregator-windows/values.yaml packages/logging/charts/charts/log-aggregator/charts/log-aggregator-windows/values.yaml
--- packages/logging/charts-original/charts/log-aggregator/charts/log-aggregator-windows/values.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/log-aggregator/charts/log-aggregator-windows/values.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,27 @@
+nameOverride: log-aggregator
+
+labels: {}
+## Log Aggregator container image
+##
+image:
+  repository: rancher/log-aggregator
+  tag: v0.1.6
+
+nodeSelector: {}
+
+# updateStrategy:
+#   type: RollingUpdate
+
+tolerations:
+  - effect: NoSchedule
+    operator: Exists
+
+## Resource limits & requests
+## Ref: https://kubernetes.io/docs/user-guide/compute-resources/
+##
+resources: {}
+  # requests:
+  #   memory: 400Mi
+
+## flexvolume dir
+flexVolumeDir: C:/var/lib/kubelet/volumeplugins
\ No newline at end of file
diff -uNr packages/logging/charts-original/charts/log-aggregator/Chart.yaml packages/logging/charts/charts/log-aggregator/Chart.yaml
--- packages/logging/charts-original/charts/log-aggregator/Chart.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/log-aggregator/Chart.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,14 @@
+name: log-aggregator
+version: 0.0.2
+appVersion: 0.1.5
+home: https://github.com/rancher/log-aggregator
+description: Deploy flexvolume driver log-aggregator to collect log.
+icon: https://raw.githubusercontent.com/fluent/fluentd-docs/master/public/logo/Fluentd_square.png
+keywords:
+- fluentd
+- flexvolume driver
+- logging
+maintainers:
+- name: michelia
+  email: support@rancher.com
+engine: gotpl
diff -uNr packages/logging/charts-original/charts/log-aggregator/requirements.yaml packages/logging/charts/charts/log-aggregator/requirements.yaml
--- packages/logging/charts-original/charts/log-aggregator/requirements.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/log-aggregator/requirements.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,10 @@
+dependencies:
+  - name: log-aggregator-linux
+    version: 0.0.1
+    condition: log-aggregator.log-aggregator-linux.enabled
+    repository: "file://./charts/log-aggregator-linux"
+
+  - name: log-aggregator-windows
+    version: 0.0.1
+    condition: log-aggregator.log-aggregator-windows.enabled
+    repository: "file://./charts/log-aggregator-window"
\ No newline at end of file
diff -uNr packages/logging/charts-original/charts/log-aggregator/templates/_helpers.tpl packages/logging/charts/charts/log-aggregator/templates/_helpers.tpl
--- packages/logging/charts-original/charts/log-aggregator/templates/_helpers.tpl	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/log-aggregator/templates/_helpers.tpl	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,37 @@
+{{/* vim: set filetype=mustache: */}}
+{{/*
+Expand the name of the chart.
+*/}}
+{{- define "log-aggregator.name" -}}
+{{- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix "-" -}}
+{{- end -}}
+
+{{/*
+Create a default fully qualified app name.
+We truncate at 63 chars because some Kubernetes name fields are limited to this (by the DNS naming spec).
+If release name contains chart name it will be used as a full name.
+*/}}
+{{- define "log-aggregator.fullname" -}}
+{{- if .Values.fullnameOverride -}}
+{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" -}}
+{{- else -}}
+{{- $name := default .Chart.Name .Values.nameOverride -}}
+{{- if contains $name .Release.Name -}}
+{{- .Release.Name | trunc 63 | trimSuffix "-" -}}
+{{- else -}}
+{{- printf "%s-%s" .Release.Name $name | trunc 63 | trimSuffix "-" -}}
+{{- end -}}
+{{- end -}}
+{{- end -}}
+{{/*
+Create chart name and version as used by the chart label.
+*/}}
+{{- define "log-aggregator.chart" -}}
+{{- printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" -}}
+{{- end -}}
+
+{{- define "log-aggregator.version" -}}
+{{- $name := include "log-aggregator.name" . -}}
+{{- $version := .Chart.Version | replace "+" "_" -}}
+{{- printf "%s-%s" $name $version -}}
+{{- end -}}
diff -uNr packages/logging/charts-original/charts/log-aggregator/templates/rbac.yaml packages/logging/charts/charts/log-aggregator/templates/rbac.yaml
--- packages/logging/charts-original/charts/log-aggregator/templates/rbac.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/log-aggregator/templates/rbac.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,38 @@
+{{- if .Values.global.podSecurityPolicy.enabled -}}
+kind: Role
+apiVersion: {{ template "rbac_api_version" . }}
+metadata:
+  name: {{ template "log-aggregator.fullname" . }}-psp-role
+  labels:
+    app: {{ template "log-aggregator.name" . }}
+    chart: {{ template "log-aggregator.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+rules:
+- apiGroups:
+  - "policy"
+  resources:
+  - "podsecuritypolicies"
+  resourceNames:
+  - {{ .Release.Name }}-psp
+  verbs:
+  - "use"
+---
+kind: RoleBinding
+apiVersion: {{ template "rbac_api_version" . }}
+metadata:
+  name: {{ template "log-aggregator.fullname" . }}-psp-rolebinding
+  labels:
+    app: {{ template "log-aggregator.name" . }}
+    chart: {{ template "log-aggregator.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
+subjects:
+- kind: ServiceAccount
+  name: {{ template "log-aggregator.fullname" . }}
+  namespace: {{ .Release.Namespace }}
+roleRef:
+  kind: Role
+  name: {{ template "log-aggregator.fullname" . }}-psp-role
+  apiGroup: rbac.authorization.k8s.io
+{{- end -}}
\ No newline at end of file
diff -uNr packages/logging/charts-original/charts/log-aggregator/templates/service-account.yaml packages/logging/charts/charts/log-aggregator/templates/service-account.yaml
--- packages/logging/charts-original/charts/log-aggregator/templates/service-account.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/log-aggregator/templates/service-account.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,9 @@
+apiVersion: v1
+kind: ServiceAccount
+metadata:
+  name: {{ template "log-aggregator.fullname" . }}
+  labels:
+    app: {{ template "log-aggregator.name" . }}
+    chart: {{ template "log-aggregator.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
diff -uNr packages/logging/charts-original/charts/log-aggregator/values.yaml packages/logging/charts/charts/log-aggregator/values.yaml
--- packages/logging/charts-original/charts/log-aggregator/values.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/charts/log-aggregator/values.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,5 @@
+log-aggregator-linux:
+  enabled: true
+
+log-aggregator-windows:
+  enabled: false
\ No newline at end of file
diff -uNr packages/logging/charts-original/Chart.yaml packages/logging/charts/Chart.yaml
--- packages/logging/charts-original/Chart.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/Chart.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -1,21 +1,12 @@
 apiVersion: v1
-appVersion: 1.3.7
-description: Fast and Lightweight Log/Data Forwarder for Linux, BSD and OSX
-home: https://fluentbit.io
-icon: https://fluentbit.io/assets/img/logo1-default.png
-keywords:
-- logging
-- monitoring
-- fluent
-- fluentd
-maintainers:
-- email: Kevin.Fox@pnnl.gov
-  name: kfox1111
-- email: eduardo@treasure-data.com
-  name: edsiper
-- email: hfernandez@mesosphere.com
-  name: hectorj2f
-name: fluent-bit
+description: Rancher logging helm chart to support logging function in rancher
+icon: https://raw.githubusercontent.com/fluent/fluentd-docs/master/public/logo/Fluentd_square.png
+name: rancher-logging
+version: 0.2.0
+appVersion: 1.6.3
+home: https://www.fluentd.org/
 sources:
-- https://fluentbit.io
-version: 2.8.11
+- https://www.fluentd.org/
+maintainers:
+- name: Michelia
+  email: support@rancher.com
diff -uNr packages/logging/charts-original/OWNERS packages/logging/charts/OWNERS
--- packages/logging/charts-original/OWNERS	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/OWNERS	1969-12-31 17:00:00.000000000 -0700
@@ -1,10 +0,0 @@
-approvers:
-- kfox1111
-- edsiper
-- hectorj2f
-- Towmeykaw
-reviewers:
-- kfox1111
-- edsiper
-- hectorj2f
-- Towmeykaw
diff -uNr packages/logging/charts-original/questions.yml packages/logging/charts/questions.yml
--- packages/logging/charts-original/questions.yml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/questions.yml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1 @@
+rancher_min_version: 2.3.4-rc1
\ No newline at end of file
diff -uNr packages/logging/charts-original/README.md packages/logging/charts/README.md
--- packages/logging/charts-original/README.md	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/README.md	2020-04-09 23:55:05.700024107 -0700
@@ -1,191 +1,11 @@
-# Fluent-Bit Chart
+# Rancher Logging
 
-[Fluent Bit](http://fluentbit.io/) is an open source and multi-platform Log Forwarder.
+* Installs [Fluentd](https://www.fluentd.org/) and flexvolume log driver to collect container logs in Rancher
 
-## Chart Details
+## Introduction
 
-This chart will do the following:
+This chart bootstraps a [Fluentd](https://www.fluentd.org/) daemonset and a [Log-Aggregator](https://github.com/rancher/log-aggregator) flexvolume on a [Kubernetes](http://kubernetes.io) cluster using the [Helm](https://helm.sh) package manager.
+It's use for sends logs to log target config in rancher.
 
-* Install a configmap for Fluent Bit
-* Install a daemonset that provisions Fluent Bit [per-host architecture]
-
-## Installing the Chart
-
-To install the chart with the release name `my-release`:
-
-```bash
-$ helm install --name my-release stable/fluent-bit
-```
-
-When installing this chart on [Minikube](https://kubernetes.io/docs/getting-started-guides/minikube/), it's required to specify that so the DaemonSet will be able to mount the log files properly, make sure to append the _--set on\_minikube=true_ option at the end of the _helm_ command, e.g:
-
-```bash
-$ helm install --name my-release stable/fluent-bit --set on_minikube=true
-```
-
-## Configuration
-
-The following table lists the configurable parameters of the Fluent-Bit chart and the default values.
-
-| Parameter                  | Description                        | Default                 |
-| -----------------------    | ---------------------------------- | ----------------------- |
-| **Backend Selection**      |
-| `backend.type`             | Set the backend to which Fluent-Bit should flush the information it gathers | `forward` |
-| **Forward Backend**        |
-| `backend.forward.host`     | Target host where Fluent-Bit or Fluentd are listening for Forward messages | `fluentd` |
-| `backend.forward.port`     | TCP Port of the target service | `24284` |
-| `backend.forward.shared_key`       | A key string known by the remote Fluentd used for authorization. | `` |
-| `backend.forward.tls`              | Enable or disable TLS support | `off` |
-| `backend.forward.tls_verify`       | Force certificate validation  | `on` |
-| `backend.forward.tls_debug`        | Set TLS debug verbosity level. It accept the following values: 0-4 | `1` |
-| **ElasticSearch Backend**  |
-| `backend.es.host`          | IP address or hostname of the target Elasticsearch instance | `elasticsearch` |
-| `backend.es.port`          | TCP port of the target Elasticsearch instance. | `9200` |
-| `backend.es.index`         | Elastic Index name | `kubernetes_cluster` |
-| `backend.es.type`          | Elastic Type name | `flb_type` |
-| `backend.es.retry_limit`   | Max number of retries to attempt (False == no limit) | `False` |
-| `backend.es.time_key`          | Elastic Time Key | `@timestamp` |
-| `backend.es.logstash_format`          | Enable Logstash format compatibility. | `On` |
-| `backend.es.logstash_prefix`  | Index Prefix. If Logstash_Prefix is equal to 'mydata' your index will become 'mydata-YYYY.MM.DD'. | `kubernetes_cluster` |
-| `backend.es.logstash_prefix_key`  | Index Prefix key. When included, the value in the record that belongs to the key will be looked up and overwrite `Logstash_Prefix` for index generation. If `Logstash_Prefix_Key` = 'mydata' the index becomes 'mydata-YYYY.MM.DD'. | `` |
-| `backend.es.replace_dots`     | Enable/Disable Replace_Dots option. | `On` |
-| `backend.es.http_user`        | Optional username credential for Elastic X-Pack access. | `` |
-| `backend.es.http_passwd`      | Password for user defined in HTTP_User. | `` |
-| `backend.es.http_passwd_secret`     | Secret name for password for user defined in HTTP_User. | `` |
-| `backend.es.http_passwd_secret_key` | Secret key for password for user defined in HTTP_User. | `` |
-| `backend.es.tls`              | Enable or disable TLS support | `off` |
-| `backend.es.tls_verify`       | Force certificate validation  | `on` |
-| `backend.es.tls_secret`        | Existing secret storing TLS CA certificate for the Elastic instance. Specify if tls: on. Overrides `backend.es.tls_ca` | `` |
-| `backend.es.tls_secret_ca_key` | Existing secret key storing TLS CA certificate for the Elastic instance. Specify if tls: on.                           | `` |
-| `backend.es.tls_ca`           | TLS CA certificate for the Elastic instance (in PEM format). Specify if tls: on. | `` |
-| `backend.es.tls_debug`        | Set TLS debug verbosity level. It accept the following values: 0-4 | `1` |
-| **HTTP Backend**              |
-| `backend.http.host`           | IP address or hostname of the target HTTP Server | `127.0.0.1` |
-| `backend.http.port`           | TCP port of the target HTTP Server | `80` |
-| `backend.http.uri`            | Specify an optional HTTP URI for the target web server, e.g: /something | `"/"`
-| `backend.http.http_user`        | Optional username credential for Basic Authentication. | `` |
-| `backend.http.http_passwd:`     | Password for user defined in HTTP_User. | `` |
-| `backend.http.format`         | Specify the data format to be used in the HTTP request body, by default it uses msgpack, optionally it can be set to json.  | `msgpack` |
-| `backend.http.json_date_format`         | Specify the format of the date. Supported formats are double and iso8601 | `double` |
-| `backend.http.headers`          | HTTP Headers | `[]` |
-| `backend.http.tls`              | Enable or disable TLS support | `off` |
-| `backend.http.tls_verify`       | Force certificate validation  | `on` |
-| `backend.http.tls_debug`        | Set TLS debug verbosity level. It accept the following values: 0-4 | `1` |
-| **Splunk Backend**              |
-| `backend.splunk.host`           | IP address or hostname of the target Splunk Server | `127.0.0.1` |
-| `backend.splunk.port`           | TCP port of the target Splunk Server | `8088` |
-| `backend.splunk.token`            | Specify the Authentication Token for the HTTP Event Collector interface. | `` |
-| `backend.splunk.send_raw`         | If enabled, record keys and values are set in the main map. | `off` |
-| `backend.splunk.tls`           | Enable or disable TLS support | `on` |
-| `backend.splunk.tls_verify`           | Force TLS certificate validation | `off` |
-| `backend.splunk.tls_debug`        | Set TLS debug verbosity level. It accept the following values: 0-4 | `1` |
-| `backend.splunk.message_key`           | Tag applied to all incoming logs | `kubernetes` |
-| **Stackdriver Backend**              |
-| `backend.stackdriver.google_service_credentials`           | Contents of a Google Cloud credentials JSON file. | `` |
-| `backend.stackdriver.service_account_email`           | Account email associated to the service. Only available if no credentials file has been provided. | `` |
-| `backend.stackdriver.service_account_secret`            | Private key content associated with the service account. Only available if no credentials file has been provided. | `` |
-| **Parsers**                   |
-| `parsers.enabled`                  | Enable custom parsers | `false` |
-| `parsers.regex`                    | List of regex parsers | `NULL` |
-| `parsers.json`                     | List of json parsers | `NULL` |
-| `parsers.logfmt`                   | List of logfmt parsers | `NULL` |
-| **General**                   |
-| `annotations`                      | Optional deamonset set annotations                      | `NULL`                              |
-| `audit.enable`                     | Enable collection of audit logs                         | `false`                             |
-| `audit.input.memBufLimit`          | Specify Mem_Buf_Limit in tail input                     | `35mb`                              |
-| `audit.input.parser`               | Specify Parser in tail input                            | `docker`                            |
-| `audit.input.tag`                  | Specify Tag in tail input                               | `audit.*`                           |
-| `audit.input.path`                 | Specify log file(s) through the use of common wildcards | `/var/log/kube-apiserver-audit.log` |
-| `audit.input.bufferChunkSize`      | Specify Buffer_Chunk_Size in tail                       | `2MB`                               |
-| `audit.input.bufferMaxSize`        | Specify Buffer_Max_Size in tail                         | `10MB`                              |
-| `audit.input.skipLongLines`        | Specify Skip_Long_Lines in tail                         | `On`                                |
-| `audit.input.key`                  | Specify Key in tail                                     | `kubernetes-audit`                             |
-| `podAnnotations`                   | Optional pod annotations                  | `NULL`                |
-| `podLabels`                        | Optional pod labels                       | `NULL`                |
-| `fullConfigMap`                    | User has provided entire config (parsers + system)  | `false`      |
-| `existingConfigMap`                | ConfigMap override                         | ``                    |
-| `extraEntries.input`               |    Extra entries for existing [INPUT] section                     | ``                    |
-| `extraEntries.filter`              |    Extra entries for existing [FILTER] section                     | ``                    |
-| `extraEntries.output`              |   Extra entries for existing [OUPUT] section                     | ``                    |
-| `extraPorts`                       | List of extra ports                        |                       |
-| `extraVolumeMounts`                | Mount an extra volume, required to mount ssl certificates when elasticsearch has tls enabled |          |
-| `extraVolume`                      | Extra volume                               |                                                |
-| `service.flush`                    | Interval to flush output (seconds)        | `1`                   |
-| `service.logLevel`                 | Diagnostic level (error/warning/info/debug/trace)        | `info`                   |
-| `filter.enableExclude`             | Enable the use of monitoring for a pod annotation of `fluentbit.io/exclude: true`. If present, discard logs from that pod.         | `true`                                 |
-| `filter.enableParser`              | Enable the use of monitoring for a pod annotation of `fluentbit.io/parser: parser_name`. parser_name must be the name of a parser contained within parsers.conf         | `true`                                 |
-| `filter.kubeURL`                   | Optional custom configmaps                 | `https://kubernetes.default.svc:443`            |
-| `filter.kubeCAFile`                | Optional custom configmaps       | `/var/run/secrets/kubernetes.io/serviceaccount/ca.crt`    |
-| `filter.kubeTokenFile`             | Optional custom configmaps       | `/var/run/secrets/kubernetes.io/serviceaccount/token`     |
-| `filter.kubeTag`                   | Optional top-level tag for matching in filter         | `kube`                                 |
-| `filter.kubeTagPrefix`             | Optional tag prefix used by Tail   | `kube.var.log.containers.`                                |
-| `filter.mergeJSONLog`              | If the log field content is a JSON string map, append the map fields as part of the log structure         | `true`                                 |
-| `filter.mergeLogKey`               | If set, append the processed log keys under a new root key specified by this variable. | `nil` |
-| `filter.useJournal`                | If true, the filter reads logs coming in Journald format.  | `false` |
-| `image.fluent_bit.repository`      | Image                                      | `fluent/fluent-bit`                               |
-| `image.fluent_bit.tag`             | Image tag                                  | `1.3.7`                                           |
-| `image.pullPolicy`                 | Image pull policy                          | `Always`                                          |
-| `nameOverride`                     | Override name of app                   | `nil`                                        |
-| `fullnameOverride`                 | Override full name of app              | `nil`                                        |
-| `image.pullSecrets`                | Specify image pull secrets                 | `nil`                                             |
-| `input.tail.memBufLimit`           | Specify Mem_Buf_Limit in tail input        | `5MB`                                             |
-| `input.tail.parser`                | Specify Parser in tail input.        | `docker`                                             |
-| `input.tail.path`                  | Specify log file(s) through the use of common wildcards.        | `/var/log/containers/*.log`                                             |
-| `input.tail.ignore_older`          | Ignores files that have been last modified before this time in seconds. Supports m,h,d (minutes, hours,days) syntax.        | ``                                             |
-| `input.systemd.enabled`            | [Enable systemd input](https://docs.fluentbit.io/manual/input/systemd)                   | `false`                                       |
-| `input.systemd.filters.systemdUnit` | Please see https://docs.fluentbit.io/manual/input/systemd | `[docker.service, kubelet.service`, `node-problem-detector.service]`                                       |
-| `input.systemd.maxEntries`         | Please see https://docs.fluentbit.io/manual/input/systemd | `1000`                             |
-| `input.systemd.readFromTail`       | Please see https://docs.fluentbit.io/manual/input/systemd | `true`                             |
-| `input.systemd.stripUnderscores`       | Please see https://docs.fluentbit.io/manual/input/systemd | `false`                             |
-| `input.systemd.tag`                | Please see https://docs.fluentbit.io/manual/input/systemd | `host.*`                           |
-| `rbac.create`                      | Specifies whether RBAC resources should be created.   | `true`                                 |
-| `rbac.pspEnabled`                  | Specifies whether a PodSecurityPolicy should be created. | `false`                             |
-| `serviceAccount.create`            | Specifies whether a ServiceAccount should be created. | `true`                                 |
-| `serviceAccount.name`              | The name of the ServiceAccount to use.     | `NULL`                                            |
-| `serviceAccount.annotations`       | Annotations to add to the service account. | `{}`                                              |
-| `rawConfig`                        | Raw contents of fluent-bit.conf            | `@INCLUDE fluent-bit-service.conf`<br>`@INCLUDE fluent-bit-input.conf`<br>`@INCLUDE fluent-bit-filter.conf`<br>` @INCLUDE fluent-bit-output.conf`                                                                         |
-| `resources`                        | Pod resource requests & limits                                 | `{}`                          |
-| `securityContext`                  | [Security settings for a container](https://kubernetes.io/docs/concepts/policy/security-context) | `{}` |
-| `podSecurityContext`               | [Security settings for a pod](https://kubernetes.io/docs/concepts/policy/security-context)       | `{}` |
-| `hostNetwork`                      | Use host's network                         | `false`                                           |
-| `dnsPolicy`                        | Specifies the dnsPolicy to use             | `ClusterFirst`                                    |
-| `priorityClassName`                | Specifies the priorityClassName to use     | `NULL`                                            |
-| `tolerations`                      | Optional daemonset tolerations             | `NULL`                                            |
-| `nodeSelector`                     | Node labels for fluent-bit pod assignment  | `NULL`                                            |
-| `affinity`                         | Expressions for affinity                   | `NULL`                                            |
-| `metrics.enabled`                  | Specifies whether a service for metrics should be exposed | `false`                            |
-| `metrics.service.annotations`      | Optional metrics service annotations       | `NULL`                                            |
-| `metrics.service.labels`           | Additional labels for the fluent-bit metrics service definition, specified as a map.                                                    | None                                              |
-| `metrics.service.port`             | Port on where metrics should be exposed    | `2020`                                            |
-| `metrics.service.type`             | Service type for metrics                   | `ClusterIP`                                       |
-| `metrics.serviceMonitor.enabled`          | Set this to `true` to create ServiceMonitor for Prometheus operator                   | `false` |
-| `metrics.serviceMonitor.additionalLabels` | Additional labels that can be used so ServiceMonitor will be discovered by Prometheus | `{}`    |
-| `metrics.serviceMonitor.namespace`        | Optional namespace in which to create ServiceMonitor                                  | `nil`   |
-| `metrics.serviceMonitor.interval`         | Scrape interval. If not set, the Prometheus default scrape interval is used           | `nil`   |
-| `metrics.serviceMonitor.scrapeTimeout`    | Scrape timeout. If not set, the Prometheus default scrape timeout is used             | `nil`   |
-| `trackOffsets`                     | Specify whether to track the file offsets for tailing docker logs. This allows fluent-bit to pick up where it left after pod restarts but requires access to a `hostPath` | `false` |
-| `testFramework.image`              | `test-framework` image repository.         | `dduportal/bats`                                  |
-| `testFramework.tag`                | `test-framework` image tag.                | `0.4.0`                                           |
-
-
-Specify each parameter using the `--set key=value[,key=value]` argument to `helm install`.
-
-Alternatively, a YAML file that specifies the values for the parameters can be provided while installing the chart. For example,
-
-```bash
-$ helm install --name my-release -f values.yaml stable/fluent-bit
-```
-
-> **Tip**: You can use the default [values.yaml](values.yaml)
-
-## Upgrading
-
-### From < 1.0.0 To >= 1.0.0
-
-Values `extraInputs`, `extraFilters` and `extraOutputs` have been removed in version `1.0.0` of the fluent-bit chart.
-To add additional entries to the existing sections, please use the `extraEntries.input`, `extraEntries.filter` and `extraEntries.output` values.
-For entire sections, please use the `rawConfig` value, inserting blocks of text as desired.
-
-### From < 1.8.0 to >= 1.8.0
-
-Version `1.8.0` introduces the use of release name as full name if it contains the chart name(fluent-bit in this case). E.g. with a release name of `fluent-bit`, this renames the DaemonSet from `fluent-bit-fluent-bit` to `fluent-bit`. The suggested approach is to delete the release and reinstall it.
+## Prerequisites
+  - Rancher 2.1+
\ No newline at end of file
diff -uNr packages/logging/charts-original/requirements.yaml packages/logging/charts/requirements.yaml
--- packages/logging/charts-original/requirements.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/requirements.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -0,0 +1,15 @@
+dependencies:
+  - name: fluentd
+    version: 0.0.2
+    condition: fluentd.enabled
+    repository: "file://./charts/fluentd/"
+
+  - name: log-aggregator
+    version: 0.0.2
+    condition: log-aggregator.enabled
+    repository: "file://./charts/log-aggregator/"
+
+  - name: fluentd-tester
+    version: 0.0.2
+    condition: fluentd-tester.enabled
+    repository: "file://./charts/fluentd-tester/"
\ No newline at end of file
diff -uNr packages/logging/charts-original/templates/cluster-rolebinding.yaml packages/logging/charts/templates/cluster-rolebinding.yaml
--- packages/logging/charts-original/templates/cluster-rolebinding.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/templates/cluster-rolebinding.yaml	1969-12-31 17:00:00.000000000 -0700
@@ -1,19 +0,0 @@
-{{- if .Values.rbac.create -}}
-apiVersion: {{ template "rbac.apiVersion" . }}
-kind: ClusterRoleBinding
-metadata:
-  labels:
-    app: {{ template "fluent-bit.name" . }}
-    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
-    heritage: {{ .Release.Service }}
-    release: {{ .Release.Name }}
-  name: {{ template "fluent-bit.fullname" . }}
-roleRef:
-  apiGroup: rbac.authorization.k8s.io
-  kind: ClusterRole
-  name: {{ template "fluent-bit.fullname" . }}
-subjects:
-  - kind: ServiceAccount
-    name: {{ template "fluent-bit.serviceAccountName" . }}
-    namespace: {{ .Release.Namespace }}
-{{- end -}}
diff -uNr packages/logging/charts-original/templates/cluster-role.yaml packages/logging/charts/templates/cluster-role.yaml
--- packages/logging/charts-original/templates/cluster-role.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/templates/cluster-role.yaml	1969-12-31 17:00:00.000000000 -0700
@@ -1,28 +0,0 @@
-{{- if .Values.rbac.create -}}
-apiVersion: {{ template "rbac.apiVersion" . }}
-kind: ClusterRole
-metadata:
-  labels:
-    app: {{ template "fluent-bit.name" . }}
-    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
-    heritage: {{ .Release.Service }}
-    release: {{ .Release.Name }}
-  name: {{ template "fluent-bit.fullname" . }}
-rules:
-  - apiGroups:
-      - ""
-    resources:
-      - pods
-    verbs:
-      - get
-{{- if .Values.rbac.pspEnabled }}
-  - apiGroups:
-    - {{ template "rbac.pspApiGroup" . }}
-    resources:
-    - podsecuritypolicies
-    resourceNames:
-    - {{ template "fluent-bit.fullname" . }}
-    verbs:
-    - use
-{{- end }}
-{{- end -}}
diff -uNr packages/logging/charts-original/templates/config.yaml packages/logging/charts/templates/config.yaml
--- packages/logging/charts-original/templates/config.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/templates/config.yaml	1969-12-31 17:00:00.000000000 -0700
@@ -1,271 +0,0 @@
-{{- if (empty .Values.existingConfigMap) -}}
-apiVersion: v1
-kind: ConfigMap
-metadata:
-  name: {{ template "fluent-bit.fullname" . }}-config
-  labels:
-    app: {{ template "fluent-bit.name" . }}
-    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
-    heritage: {{ .Release.Service }}
-    release: {{ .Release.Name }}
-data:
-  fluent-bit-service.conf: |
-    [SERVICE]
-        Flush        {{ .Values.service.flush }}
-        Daemon       Off
-        Log_Level    {{ .Values.service.logLevel }}
-        Parsers_File parsers.conf
-{{- if .Values.parsers.enabled }}
-        Parsers_File parsers_custom.conf
-{{- end }}
-{{- if .Values.metrics.enabled }}
-        HTTP_Server  On
-        HTTP_Listen  0.0.0.0
-        HTTP_Port    2020
-{{- end }}
-
-  fluent-bit-input.conf: |
-    [INPUT]
-        Name             tail
-        Path             {{ .Values.input.tail.path }}
-        Parser           {{ .Values.input.tail.parser }}
-        Tag              {{ .Values.filter.kubeTag }}.*
-        Refresh_Interval 5
-        Mem_Buf_Limit    {{ .Values.input.tail.memBufLimit }}
-        Skip_Long_Lines  On
-{{- if .Values.input.tail.ignore_older }}
-        Ignore_Older    {{ .Values.input.tail.ignore_older }}
-{{- end }}
-{{- if .Values.trackOffsets }}
-        DB               /tail-db/tail-containers-state.db
-        DB.Sync          Normal
-{{- end }}
-{{- if .Values.input.systemd.enabled }}
-    [INPUT]
-        Name            systemd
-        Tag             {{ .Values.input.systemd.tag }}
-{{- range $value := .Values.input.systemd.filters.systemdUnit }}
-        Systemd_Filter  _SYSTEMD_UNIT={{ $value }}
-{{- end }}
-        Max_Entries     {{ .Values.input.systemd.maxEntries }}
-        Read_From_Tail  {{ .Values.input.systemd.readFromTail }}
-        Strip_Underscores  {{ .Values.input.systemd.stripUnderscores }}
-{{- end }}
-{{ .Values.extraEntries.input | indent 8 }}
-
-{{- if .Values.audit.enable }}
-    [INPUT]
-        Name              tail
-        Path              {{ .Values.audit.input.path }}
-        Parser            {{ .Values.audit.input.parser }}
-        DB                /var/log/audit.db
-        Tag               {{ .Values.audit.input.tag }}
-        Refresh_Interval  5
-        Mem_Buf_Limit     {{ .Values.audit.input.memBufLimit }}
-        Buffer_Chunk_Size {{ .Values.audit.input.bufferChunkSize }}
-        Buffer_Max_Size   {{ .Values.audit.input.bufferMaxSize }}
-        Skip_Long_Lines   {{ .Values.audit.input.skipLongLines}}
-        Key               {{ .Values.audit.input.key}}
-{{ .Values.extraEntries.audit | indent 8 }}
-{{- end }}
-
-  fluent-bit-filter.conf: |
-    [FILTER]
-        Name                kubernetes
-        Match               {{ .Values.filter.kubeTag }}.*
-        Kube_Tag_Prefix     {{ .Values.filter.kubeTagPrefix }}
-        Kube_URL            {{ .Values.filter.kubeURL }}
-        Kube_CA_File        {{ .Values.filter.kubeCAFile }}
-        Kube_Token_File     {{ .Values.filter.kubeTokenFile }}
-{{- if .Values.filter.mergeJSONLog }}
-        Merge_Log           On
-{{- end }}
-
-{{- if .Values.filter.mergeLogKey }}
-        Merge_Log_Key       {{ .Values.filter.mergeLogKey }}
-{{- end }}
-
-{{- if .Values.filter.enableParser }}
-        K8S-Logging.Parser  On
-{{- end }}
-{{- if .Values.filter.enableExclude }}
-        K8S-Logging.Exclude On
-{{- end }}
-{{- if .Values.filter.useJournal }}
-        Use_Journal         On
-{{- end }}
-{{ .Values.extraEntries.filter | indent 8 }}
-
-  fluent-bit-output.conf: |
-{{ if eq .Values.backend.type "test" }}
-    [OUTPUT]
-        Name  file
-        Match *
-        Path /tmp/fluent-bit.log
-{{ else if eq .Values.backend.type "forward" }}
-    [OUTPUT]
-        Name          forward
-        Match         *
-        Host          {{ .Values.backend.forward.host }}
-        Port          {{ .Values.backend.forward.port }}
-        Retry_Limit False
-{{- if .Values.backend.forward.shared_key }}
-        Shared_Key    {{ .Values.backend.forward.shared_key }}
-{{- end }}
-{{- if .Values.backend.forward.tls }}
-        tls           {{ .Values.backend.forward.tls }}
-{{- end }}
-{{- if .Values.backend.forward.tls_verify }}
-        tls.verify    {{ .Values.backend.forward.tls_verify }}
-{{- end }}
-{{- if .Values.backend.forward.tls_debug }}
-        tls.debug     {{ .Values.backend.forward.tls_debug }}
-{{- end }}
-{{ else if eq .Values.backend.type "es" }}
-    [OUTPUT]
-        Name  es
-        Match *
-        Host  {{ .Values.backend.es.host }}
-        Port  {{ .Values.backend.es.port }}
-        Logstash_Format {{ default "On" .Values.backend.es.logstash_format  }}
-        Retry_Limit {{ .Values.backend.es.retry_limit }}
-        Type  {{ .Values.backend.es.type }}
-{{- if .Values.backend.es.time_key }}
-        Time_Key {{ .Values.backend.es.time_key }}
-{{- end }}
-{{- if .Values.backend.es.replace_dots }}
-        Replace_Dots {{ .Values.backend.es.replace_dots }}
-{{- end }}
-{{- if .Values.backend.es.logstash_prefix }}
-        Logstash_Prefix {{ .Values.backend.es.logstash_prefix }}
-{{- if .Values.backend.es.logstash_prefix_key }}
-        Logstash_Prefix_Key {{ .Values.backend.es.logstash_prefix_key }}
-{{- end }}
-{{ else if .Values.backend.es.index }}
-        Index {{ .Values.backend.es.index }}
-{{- end }}
-{{- if .Values.backend.es.http_user }}
-        HTTP_User {{ .Values.backend.es.http_user }}
-{{- if .Values.backend.es.http_passwd }}
-        HTTP_Passwd {{ .Values.backend.es.http_passwd }}
-{{- else }}
-        HTTP_Passwd ${HTTP_PASSWORD}
-{{- end }}
-{{- end }}
-{{if eq .Values.backend.es.tls "on" }}
-        tls {{ .Values.backend.es.tls }}
-        tls.verify {{ .Values.backend.es.tls_verify }}
-        tls.debug {{ .Values.backend.es.tls_debug }}
-{{- if .Values.backend.es.tls_ca }}
-        tls.ca_file /secure/es-tls-ca.crt
-{{- end }}
-{{- end }}
-{{ else if eq .Values.backend.type "splunk" }}
-    [OUTPUT]
-        Name  splunk
-        Match *
-        Host  {{ .Values.backend.splunk.host }}
-        Port  {{ .Values.backend.splunk.port }}
-        Splunk_Token  {{ .Values.backend.splunk.token }}
-        Splunk_Send_Raw {{ .Values.backend.splunk.send_raw}}
-        TLS   {{ .Values.backend.splunk.tls }}
-        TLS.Verify   {{ .Values.backend.splunk.tls_verify }}
-        tls.debug {{ .Values.backend.splunk.tls_debug }}
-        Message_Key   {{ .Values.backend.splunk.message_key }}
-{{ else if eq .Values.backend.type "stackdriver" }}
-    [OUTPUT]
-        Name  stackdriver
-        Match *
-        resource global
-{{- if .Values.backend.stackdriver.google_service_credentials }}
-        google_service_credentials /secure/google_service_credentials.json
-{{- else }}
-        service_account_email  {{ .Values.backend.stackdriver.service_account_email }}
-        service_account_secret  {{ .Values.backend.stackdriver.service_account_secret }}
-{{- end }}
-{{ else if eq .Values.backend.type "http" }}
-    [OUTPUT]
-        Name  http
-        Match *
-        Host {{ .Values.backend.http.host }}
-        Port {{ .Values.backend.http.port }}
-        URI {{ .Values.backend.http.uri }}
-{{- if .Values.backend.http.http_user }}
-        HTTP_User {{ .Values.backend.http.http_user }}
-        HTTP_Passwd {{ .Values.backend.http.http_passwd }}
-{{- end }}
-        tls {{ .Values.backend.http.tls }}
-        tls.verify {{ .Values.backend.http.tls_verify }}
-        tls.debug {{ .Values.backend.http.tls_debug }}
-{{- if .Values.backend.http.proxy }}
-        Proxy {{ .Values.backend.http.proxy }}
-{{- end }}
-        Format {{ .Values.backend.http.format }}
-{{- end }}
-{{- if .Values.backend.http.json_date_format }}
-        json_date_format {{ .Values.backend.http.json_date_format }}
-{{- end }}
-{{- range  .Values.backend.http.headers }}
-        Header  {{ . }}
-{{- end }}
-{{ .Values.extraEntries.output | indent 8 }}
-
-
-  fluent-bit.conf: |
-{{ .Values.rawConfig | indent 4 }}
-
-  parsers.conf: |
-{{- if .Values.parsers.regex }}
-{{- range .Values.parsers.regex }}
-    [PARSER]
-        Name        {{ .name }}
-        Format      regex
-        Regex       {{ .regex }}
-{{- if .timeKey }}
-        Time_Key    {{ .timeKey }}
-{{- end }}
-{{- if .timeFormat }}
-        Time_Format {{ .timeFormat }}
-{{- end }}
-{{ end }}
-{{- end }}
-{{- if .Values.parsers.json }}
-{{- range .Values.parsers.json }}
-    [PARSER]
-        Name        {{ .name }}
-        Format      json
-{{- if .timeKeep }}
-        Time_Keep   {{ .timeKeep }}
-{{- end }}
-{{- if .timeKey }}
-        Time_Key    {{ .timeKey }}
-{{- end }}
-{{- if .timeFormat }}
-        Time_Format {{ .timeFormat }}
-{{- end }}
-{{- if .decodeFieldAs  }}
-        Decode_Field_As {{ .decodeFieldAs }} {{ .decodeField | default "log" }}
-{{- end}}
-{{- if .extraEntries }}
-{{ .extraEntries | indent 8 }}
-{{- end }}
-{{ end }}
-{{- end }}
-{{- if .Values.parsers.logfmt }}
-{{- range .Values.parsers.logfmt }}
-    [PARSER]
-        Name        {{ .name }}
-        Format      logfmt
-{{- if .timeKey }}
-        Time_Key    {{ .timeKey }}
-{{- end }}
-{{- if .timeFormat }}
-        Time_Format {{ .timeFormat }}
-{{- end }}
-{{- if .extraEntries }}
-{{ .extraEntries | indent 8 }}
-{{- end }}
-{{ end }}
-{{- end }}
-
-{{- end -}}
diff -uNr packages/logging/charts-original/templates/daemonset.yaml packages/logging/charts/templates/daemonset.yaml
--- packages/logging/charts-original/templates/daemonset.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/templates/daemonset.yaml	1969-12-31 17:00:00.000000000 -0700
@@ -1,192 +0,0 @@
-apiVersion: {{ template "daemonSet.apiVersion" . }}
-kind: DaemonSet
-metadata:
-  name: {{ template "fluent-bit.fullname" . }}
-  labels:
-    app: {{ template "fluent-bit.name" . }}
-    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
-    heritage: {{ .Release.Service }}
-    release: {{ .Release.Name }}
-spec:
-  selector:
-    matchLabels:
-      app: {{ template "fluent-bit.name" . }}
-      release: {{ .Release.Name }}
-{{- if .Values.podLabels }}
-{{ toYaml .Values.podLabels | indent 6 }}
-{{- end }}
-  updateStrategy:
-    type: RollingUpdate
-  template:
-    metadata:
-      labels:
-        app: {{ template "fluent-bit.name" . }}
-        release: {{ .Release.Name }}
-{{- if .Values.podLabels }}
-{{ toYaml .Values.podLabels | indent 8 }}
-{{- end }}
-      annotations:
-        checksum/config: {{ include (print $.Template.BasePath "/config.yaml") . | sha256sum }}
-{{- if .Values.podAnnotations }}
-{{ toYaml .Values.podAnnotations | indent 8 }}
-{{- end }}
-    spec:
-{{- if .Values.podSecurityContext }}
-      securityContext:
-{{ toYaml .Values.podSecurityContext | indent 8 }}
-{{- end }}
-{{- if .Values.priorityClassName }}
-      priorityClassName: "{{ .Values.priorityClassName }}"
-{{- end }}
-{{- if .Values.image.pullSecrets }}
-      imagePullSecrets:
-{{ toYaml .Values.image.pullSecrets | indent 8 }}
-{{- end }}
-      hostNetwork: {{ .Values.hostNetwork }}
-      dnsPolicy: {{ .Values.dnsPolicy }}
-      serviceAccountName: {{ template "fluent-bit.serviceAccountName" . }}
-      containers:
-      - name: fluent-bit
-        image: "{{ .Values.image.fluent_bit.repository }}:{{ .Values.image.fluent_bit.tag }}"
-        imagePullPolicy: "{{ .Values.image.pullPolicy }}"
-        env:
-{{- if .Values.backend.es.http_passwd_secret }}
-          - name: HTTP_PASSWORD
-            valueFrom:
-              secretKeyRef:
-                name: {{ .Values.backend.es.http_passwd_secret }}
-                key: {{ .Values.backend.es.http_passwd_secret_key }}
-{{- end }}
-{{- /* Only render empty array when no HTTP_PASSWORD */ -}}
-{{- if or .Values.env (not .Values.backend.es.http_passwd_secret) }}
-{{ toYaml .Values.env | indent 10 }}
-{{- end }}
-        resources:
-{{ toYaml .Values.resources | indent 10 }}
-{{- if or .Values.metrics.enabled .Values.extraPorts }}
-        ports:
-{{- if .Values.metrics.enabled }}
-        - name: metrics
-          containerPort: 2020
-          protocol: TCP
-{{- end -}}
-{{- if .Values.extraPorts }}
-{{ toYaml .Values.extraPorts | indent 8 }}
-{{- end }}
-{{- end }}
-{{- if .Values.securityContext }}
-        securityContext:
-{{ toYaml .Values.securityContext | indent 10 }}
-{{- end }}
-        volumeMounts:
-        - name: varlog
-          mountPath: /var/log
-        - name: varlibdockercontainers
-          mountPath: /var/lib/docker/containers
-          readOnly: true
-      {{- if .Values.input.systemd.enabled }}
-        - name: etcmachineid
-          mountPath: /etc/machine-id
-          readOnly: true
-      {{- end }}
-{{- if .Values.fullConfigMap }}
-        - name: config
-          mountPath: /fluent-bit/etc
-{{- else }}
-        - name: config
-          mountPath: /fluent-bit/etc/fluent-bit.conf
-          subPath: fluent-bit.conf
-        - name: config
-          mountPath: /fluent-bit/etc/fluent-bit-service.conf
-          subPath: fluent-bit-service.conf
-        - name: config
-          mountPath: /fluent-bit/etc/fluent-bit-input.conf
-          subPath: fluent-bit-input.conf
-        - name: config
-          mountPath: /fluent-bit/etc/fluent-bit-filter.conf
-          subPath: fluent-bit-filter.conf
-        - name: config
-          mountPath: /fluent-bit/etc/fluent-bit-output.conf
-          subPath: fluent-bit-output.conf
-
-{{- if .Values.parsers.enabled }}
-        - name: config
-          mountPath: /fluent-bit/etc/parsers_custom.conf
-          subPath: parsers.conf
-{{- end }}
-{{- if and .Values.backend.type "stackdriver" .Values.backend.stackdriver.google_service_credentials }}
-        - name: gcp-stackdriver-secret
-          mountPath: /secure/google_service_credentials.json
-          subPath: google_service_credentials.json
-{{- end }}
-{{- end }}
-{{- if or .Values.backend.es.tls_ca .Values.backend.es.tls_secret }}
-        - name: es-tls-secret
-          mountPath: /secure/es-tls-ca.crt
-          subPath: {{ .Values.backend.es.tls_secret_ca_key | default "es-tls-ca.crt" | quote }}
-{{- end }}
-{{- if .Values.trackOffsets }}
-        - name: tail-db
-          mountPath: /tail-db
-{{- end }}
-{{- if .Values.extraVolumeMounts }}
-{{ toYaml .Values.extraVolumeMounts | indent 8 }}
-{{- end }}
-{{ if .Values.on_minikube }}
-        - name: mnt
-          mountPath: /mnt
-          readOnly: true
-{{ end }}
-      terminationGracePeriodSeconds: 10
-    {{- if .Values.nodeSelector }}
-      nodeSelector:
-{{ toYaml .Values.nodeSelector | indent 8 }}
-    {{- end }}
-      {{ if .Values.affinity }}
-      affinity:
-{{ toYaml .Values.affinity | indent 8 }}
-      {{- end }}
-    {{- if .Values.tolerations }}
-      tolerations:
-{{ toYaml .Values.tolerations | indent 8 }}
-    {{- end }}
-      volumes:
-      - name: varlog
-        hostPath:
-          path: /var/log
-      - name: varlibdockercontainers
-        hostPath:
-          path: /var/lib/docker/containers
-    {{- if .Values.input.systemd.enabled }}
-      - name: etcmachineid
-        hostPath:
-          path: /etc/machine-id
-          type: File
-    {{- end }}
-{{- if or .Values.backend.es.tls_ca .Values.backend.es.tls_secret }}
-      - name: es-tls-secret
-        secret:
-          secretName: {{ .Values.backend.es.tls_secret | default ( print ( include "fluent-bit.fullname" . ) "-es-tls-secret" ) | quote }}
-{{- end }}
-{{- if and .Values.backend.type "stackdriver" .Values.backend.stackdriver.google_service_credentials }}
-      - name: gcp-stackdriver-secret
-        secret:
-          secretName: "{{ template "fluent-bit.fullname" . }}-gcp-stackdriver-secret"
-{{- end }}
-{{- if .Values.trackOffsets }}
-      - name: tail-db
-        hostPath:
-          path: {{ .Values.taildb.directory }}
-          type: DirectoryOrCreate
-{{- end }}
-      - name: config
-        configMap:
-          name: {{ if .Values.existingConfigMap }}{{ .Values.existingConfigMap }}{{- else }}{{ template "fluent-bit.fullname" . }}-config{{- end }}
-{{- if .Values.extraVolumes }}
-{{ toYaml .Values.extraVolumes | indent 6 }}
-{{- end }}
-{{ if .Values.on_minikube }}
-      - name: mnt
-        hostPath:
-          path: /mnt
-{{ end }}
diff -uNr packages/logging/charts-original/templates/_helpers.tpl packages/logging/charts/templates/_helpers.tpl
--- packages/logging/charts-original/templates/_helpers.tpl	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/templates/_helpers.tpl	2020-04-09 23:55:05.700024107 -0700
@@ -1,78 +1,70 @@
 {{/* vim: set filetype=mustache: */}}
-{{/*
-Expand the name of the chart.
-*/}}
-{{- define "fluent-bit.name" -}}
+
+{{- define "logging.name" -}}
 {{- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix "-" -}}
 {{- end -}}
 
-{{/*
-Create a default fully qualified app name.
-We truncate at 63 chars because some Kubernetes name fields are limited to this (by the DNS naming spec).
-If release name contains chart name it will be used as a full name.
-*/}}
-{{- define "fluent-bit.fullname" -}}
-{{- if .Values.fullnameOverride -}}
-{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" -}}
-{{- else -}}
-{{- $name := default .Chart.Name .Values.nameOverride -}}
-{{- if contains $name .Release.Name -}}
-{{- .Release.Name | trunc 63 | trimSuffix "-" -}}
-{{- else -}}
-{{- printf "%s-%s" .Release.Name $name | trunc 63 | trimSuffix "-" -}}
+{{- define "logging.version" -}}
+{{- $name := include "logging.name" . -}}
+{{- $version := .Chart.Version | replace "+" "_" -}}
+{{- printf "%s-%s" $name $version -}}
 {{- end -}}
+
+{{- define "deployment_api_version" -}}
+{{- if .Capabilities.APIVersions.Has "apps/v1" -}}
+{{- "apps/v1" -}}
+{{- else if .Capabilities.APIVersions.Has "apps/v1beta2" -}}
+{{- "apps/v1beta2" -}}
+{{- else if .Capabilities.APIVersions.Has "apps/v1beta1" -}}
+{{- "apps/v1beta1" -}}
+{{- else -}}
+{{- "extensions/v1beta1" -}}
 {{- end -}}
 {{- end -}}
 
-{{/*
-Create chart name and version as used by the chart label.
-*/}}
-{{- define "fluent-bit.chart" -}}
-{{- printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" -}}
+
+{{- define "daemonset_api_version" -}}
+{{- if .Capabilities.APIVersions.Has "apps/v1" -}}
+{{- "apps/v1" -}}
+{{- else if .Capabilities.APIVersions.Has "apps/v1beta2" -}}
+{{- "apps/v1beta2" -}}
+{{- else -}}
+{{- "extensions/v1beta1" -}}
 {{- end -}}
+{{- end -}}
+
 
-{{/*
-Return the appropriate apiVersion for RBAC APIs.
-*/}}
-{{- define "rbac.apiVersion" -}}
+{{- define "rbac_api_version" -}}
 {{- if .Capabilities.APIVersions.Has "rbac.authorization.k8s.io/v1" -}}
-rbac.authorization.k8s.io/v1
+{{- "rbac.authorization.k8s.io/v1" -}}
 {{- else if .Capabilities.APIVersions.Has "rbac.authorization.k8s.io/v1beta1" -}}
-rbac.authorization.k8s.io/v1beta1
+{{- "rbac.authorization.k8s.io/v1beta1" -}}
 {{- else -}}
-rbac.authorization.k8s.io/v1alpha1
+{{- "rbac.authorization.k8s.io/v1alpha1" -}}
 {{- end -}}
 {{- end -}}
 
-{{/*
-Create the name of the service account to use
-*/}}
-{{- define "fluent-bit.serviceAccountName" -}}
-{{- if .Values.serviceAccount.create -}}
-    {{ default (include "fluent-bit.fullname" .) .Values.serviceAccount.name }}
+
+{{- define "system_default_registry" -}}
+{{- if .Values.global.systemDefaultRegistry -}}
+{{- printf "%s/" .Values.global.systemDefaultRegistry -}}
 {{- else -}}
-    {{ default "default" .Values.serviceAccount.name }}
+{{- "" -}}
 {{- end -}}
 {{- end -}}
 
-{{/*
-Return the appropriate apiGroup for PodSecurityPolicy.
-*/}}
-{{- define "rbac.pspApiGroup" -}}
+{{- define "linux-node-selector" -}}
 {{- if semverCompare "<1.14-0" .Capabilities.KubeVersion.GitVersion -}}
-{{- print "extensions" -}}
-{{- else if semverCompare ">=1.14-0" .Capabilities.KubeVersion.GitVersion -}}
-{{- print "policy" -}}
+beta.kubernetes.io/os: linux
+{{- else -}}
+kubernetes.io/os: linux
 {{- end -}}
 {{- end -}}
 
-{{/*
-Return the appropriate apiVersion for DaemonSet.
-*/}}
-{{- define "daemonSet.apiVersion" -}}
-{{- if semverCompare "<1.9-0" .Capabilities.KubeVersion.GitVersion -}}
-{{- print "extensions/v1beta1" -}}
+{{- define "windows-node-selector" -}}
+{{- if semverCompare "<1.14-0" .Capabilities.KubeVersion.GitVersion -}}
+beta.kubernetes.io/os: windows
 {{- else -}}
-{{- print "apps/v1" -}}
-{{- end -}}
+kubernetes.io/os: windows
 {{- end -}}
+{{- end -}}
\ No newline at end of file
diff -uNr packages/logging/charts-original/templates/NOTES.txt packages/logging/charts/templates/NOTES.txt
--- packages/logging/charts-original/templates/NOTES.txt	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/templates/NOTES.txt	1969-12-31 17:00:00.000000000 -0700
@@ -1,15 +0,0 @@
-fluent-bit is now running.
-
-{{- if eq .Values.backend.type "forward" }}
-
-It will forward all container logs to the svc named {{ .Values.backend.forward.host }} on port: {{ .Values.backend.forward.port }}
-{{- else if eq .Values.backend.type "es" }}
-
-It will forward all container logs to the svc named {{ .Values.backend.es.host }} on port: {{ .Values.backend.es.port }}
-{{- else if eq .Values.backend.type "http" }}
-
-It will forward all container logs to the svc named {{ .Values.backend.http.host }} on port: {{ .Values.backend.http.port }}
-{{- else if eq .Values.backend.type "splunk" }}
-
-It will forward all container logs to the svc named {{ .Values.backend.splunk.host }} on port: {{ .Values.backend.splunk.port }}
-{{- end }}
diff -uNr packages/logging/charts-original/templates/psp.yaml packages/logging/charts/templates/psp.yaml
--- packages/logging/charts-original/templates/psp.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/templates/psp.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -1,60 +1,43 @@
-{{- if .Values.rbac.pspEnabled }}
+{{- if .Values.global.podSecurityPolicy.enabled }}
 apiVersion: policy/v1beta1
 kind: PodSecurityPolicy
 metadata:
-  name: {{ template "fluent-bit.fullname" . }}
+  name: {{ .Release.Name }}-psp
+  labels:
+    app: {{ template "logging.name" . }}
+    chart: {{ template "logging.version" . }}
+    release: {{ .Release.Name }}
+    heritage: {{ .Release.Service }}
 spec:
-  # Prevents running in privileged mode
-  privileged: false
-  # Required to prevent escalations to root.
+{{- if .Values.global.privileged }}
+  privileged: true
+{{- else }}
   allowPrivilegeEscalation: false
-  # This is redundant with non-root + disallow privilege escalation,
-  # but we can provide it for defense in depth.
-  requiredDropCapabilities:
-    - ALL
-  volumes:
-    - 'configMap'
-    - 'secret'
-    - 'hostPath'
-  allowedHostPaths:
-    - pathPrefix: "/var/log"
-    - pathPrefix: "/var/lib/docker/containers"
-      readOnly: true
-{{- if .Values.input.systemd.enabled }}
-    - pathPrefix: "/etc/machine-id"
-      readOnly: true
-{{- end }}
-    - pathPrefix: "/fluent-bit/etc"
-{{- if .Values.trackOffsets }}
-    - pathPrefix: {{ .Values.taildb.directory }}
 {{- end }}
-{{- if .Values.on_minikube }}
-    - pathPrefix: "/mnt"
-{{- end }}
-{{- range .Values.extraVolumes }}
-  {{- if .hostPath }}
-    - pathPrefix: {{ .hostPath.path }}
-  {{- end }}
-{{- end }}
-  hostNetwork: {{ .Values.hostNetwork }}
-  hostIPC: false
-  hostPID: false
+  fsGroup:
+    ranges:
+    - max: 65535
+      min: 1
+    rule: MustRunAs
+  requiredDropCapabilities:
+  - ALL
   runAsUser:
-    rule: 'RunAsAny'
+    rule: RunAsAny
   seLinux:
-    # This policy assumes the nodes are using AppArmor rather than SELinux.
-    rule: 'RunAsAny'
+    rule: RunAsAny
   supplementalGroups:
-    rule: 'MustRunAs'
-    ranges:
-      # Forbid adding the root group.
-      - min: 1
-        max: 65535
-  fsGroup:
-    rule: 'MustRunAs'
     ranges:
-      # Forbid adding the root group.
-      - min: 1
-        max: 65535
-  readOnlyRootFilesystem: false
+    - max: 65535
+      min: 1
+    rule: MustRunAs
+  volumes:
+  - configMap
+  - emptyDir
+  - projected
+  - secret
+  - downwardAPI
+  - persistentVolumeClaim
+  - hostPath
+  allowedHostPaths:
+    - pathPrefix: /
 {{- end }}
diff -uNr packages/logging/charts-original/templates/secret.yaml packages/logging/charts/templates/secret.yaml
--- packages/logging/charts-original/templates/secret.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/templates/secret.yaml	1969-12-31 17:00:00.000000000 -0700
@@ -1,30 +0,0 @@
-{{- if not .Values.backend.es.tls_secret }}
----
-apiVersion: v1
-kind: Secret
-metadata:
-  name: "{{ template "fluent-bit.fullname" . }}-es-tls-secret"
-  labels:
-    app: {{ template "fluent-bit.name" . }}
-    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
-    heritage: {{ .Release.Service }}
-    release: {{ .Release.Name }}
-type: Opaque
-data:
-  es-tls-ca.crt: {{ .Values.backend.es.tls_ca | b64enc | quote }}
-{{- end }}
-{{- if eq .Values.backend.type "stackdriver" }}
----
-apiVersion: v1
-kind: Secret
-metadata:
-  name: "{{ template "fluent-bit.fullname" . }}-gcp-stackdriver-secret"
-  labels:
-    app: {{ template "fluent-bit.name" . }}
-    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
-    heritage: {{ .Release.Service }}
-    release: {{ .Release.Name }}
-type: Opaque
-data:
-  google_service_credentials.json: {{ .Values.backend.stackdriver.google_service_credentials | b64enc | quote }}
-{{- end }}
diff -uNr packages/logging/charts-original/templates/serviceaccount.yaml packages/logging/charts/templates/serviceaccount.yaml
--- packages/logging/charts-original/templates/serviceaccount.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/templates/serviceaccount.yaml	1969-12-31 17:00:00.000000000 -0700
@@ -1,15 +0,0 @@
-{{- if .Values.serviceAccount.create -}}
-apiVersion: v1
-kind: ServiceAccount
-metadata:
-  labels:
-    app: {{ template "fluent-bit.name" . }}
-    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
-    heritage: {{ .Release.Service }}
-    release: {{ .Release.Name }}
-  name: {{ template "fluent-bit.serviceAccountName" . }}
-  {{- with .Values.serviceAccount.annotations }}
-  annotations:
-    {{- toYaml . | nindent 4 }}
-  {{- end }}
-{{- end -}}
diff -uNr packages/logging/charts-original/templates/servicemonitor.yaml packages/logging/charts/templates/servicemonitor.yaml
--- packages/logging/charts-original/templates/servicemonitor.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/templates/servicemonitor.yaml	1969-12-31 17:00:00.000000000 -0700
@@ -1,34 +0,0 @@
-{{- if and .Values.metrics.enabled .Values.metrics.serviceMonitor.enabled (.Capabilities.APIVersions.Has "monitoring.coreos.com/v1") }}
-apiVersion: monitoring.coreos.com/v1
-kind: ServiceMonitor
-metadata:
-  name: {{ include "fluent-bit.fullname" . }}
-  {{- if .Values.metrics.serviceMonitor.namespace }}
-  namespace: {{ .Values.metrics.serviceMonitor.namespace }}
-  {{- end }}
-  labels:
-    app: {{ template "fluent-bit.name" . }}
-    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
-    heritage: {{ .Release.Service }}
-    release: {{ .Release.Name }}
-    {{- if .Values.metrics.serviceMonitor.additionalLabels }}
-{{ toYaml .Values.metrics.serviceMonitor.additionalLabels | indent 4 }}
-    {{- end }}
-spec:
-  endpoints:
-    - port: metrics
-      path: /api/v1/metrics/prometheus
-      {{- if .Values.metrics.serviceMonitor.interval }}
-      interval: {{ .Values.metrics.serviceMonitor.interval }}
-      {{- end }}
-      {{- if .Values.metrics.serviceMonitor.scrapeTimeout }}
-      scrapeTimeout: {{ .Values.metrics.serviceMonitor.scrapeTimeout }}
-      {{- end }}
-  namespaceSelector:
-    matchNames:
-      - {{ .Release.Namespace }}
-  selector:
-    matchLabels:
-      app: {{ include "fluent-bit.name" . }}
-      release: {{ .Release.Name }}
-{{- end }}
diff -uNr packages/logging/charts-original/templates/service.yaml packages/logging/charts/templates/service.yaml
--- packages/logging/charts-original/templates/service.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/templates/service.yaml	1969-12-31 17:00:00.000000000 -0700
@@ -1,30 +0,0 @@
-{{- if .Values.metrics.enabled }}
-apiVersion: v1
-kind: Service
-metadata:
-{{- if .Values.metrics.service.annotations }}
-  annotations:
-{{ toYaml .Values.metrics.service.annotations | indent 4 }}
-{{- end }}
-  name: {{ template "fluent-bit.fullname" . }}-metrics
-  labels:
-    app: {{ template "fluent-bit.name" . }}
-    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
-    heritage: {{ .Release.Service }}
-    release: {{ .Release.Name }}
-  {{- if .Values.metrics.service }}
-  {{- range $key, $value := .Values.metrics.service.labels }}
-    {{ $key }}: {{ $value | quote }}
-  {{- end }}
-  {{- end }}
-spec:
-  type: {{ .Values.metrics.service.type}}
-  sessionAffinity: None
-  ports:
-  - port: {{ .Values.metrics.service.port }}
-    targetPort: metrics
-    name: metrics
-  selector:
-    app: {{ template "fluent-bit.name" . }}
-    release: {{ .Release.Name }}
-{{- end }}
diff -uNr packages/logging/charts-original/templates/tests/test-configmap.yaml packages/logging/charts/templates/tests/test-configmap.yaml
--- packages/logging/charts-original/templates/tests/test-configmap.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/templates/tests/test-configmap.yaml	1969-12-31 17:00:00.000000000 -0700
@@ -1,48 +0,0 @@
-apiVersion: v1
-kind: ConfigMap
-metadata:
-  name: {{ template "fluent-bit.fullname" . }}-test
-  labels:
-    app: {{ template "fluent-bit.fullname" . }}
-    chart: "{{ .Chart.Name }}-{{ .Chart.Version }}"
-    heritage: "{{ .Release.Service }}"
-    release: "{{ .Release.Name }}"
-data:
-  run.sh: |-
-    {{- if eq .Values.backend.type "forward"}}
-    {{- if eq .Values.backend.forward.tls "on"}}
-    fluent-gem install fluent-plugin-secure-forward
-    {{- end }}
-    @test "Test fluentd" {
-      fluentd -c /tests/fluentd.conf --dry-run
-    }
-    {{- else if eq .Values.backend.type "es"}}
-    @test "Test Elasticssearch Indices" {
-      url="http://{{ .Values.backend.es.host }}:{{ .Values.backend.es.port }}/_cat/indices?format=json"
-      body=$(curl $url)
-
-      result=$(echo $body | jq -cr '.[] | select(.index | contains("{{ .Values.backend.es.index }}"))')
-      [ "$result" != "" ]
-
-      result=$(echo $body | jq -cr '.[] | select((.index | contains("{{ .Values.backend.es.index }}")) and (.health != "green"))')
-      [ "$result" == "" ]
-    }
-    {{- end }}
-
-  fluentd.conf: |-
-    <source>
-      {{- if eq .Values.backend.forward.tls "off" }}
-      @type forward
-      bind 0.0.0.0
-      port {{ .Values.backend.forward.port }}
-      {{- else }}
-      @type secure_forward
-      self_hostname myserver.local
-      secure no
-      {{- end }}
-      shared_key {{ .Values.backend.forward.shared_key }}
-    </source>
-
-    <match **>
-      @type stdout
-    </match>
diff -uNr packages/logging/charts-original/templates/tests/test.yaml packages/logging/charts/templates/tests/test.yaml
--- packages/logging/charts-original/templates/tests/test.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/templates/tests/test.yaml	1969-12-31 17:00:00.000000000 -0700
@@ -1,53 +0,0 @@
-{{- if or (eq .Values.backend.type "forward") (and (eq .Values.backend.type "es") (eq .Values.backend.es.tls "off")) }}
-apiVersion: v1
-kind: Pod
-metadata:
-  name: {{ template "fluent-bit.fullname" . }}-test
-  labels:
-    app: {{ template "fluent-bit.fullname" . }}
-    chart: "{{ .Chart.Name }}-{{ .Chart.Version }}"
-    heritage: "{{ .Release.Service }}"
-    release: "{{ .Release.Name }}"
-  annotations:
-    "helm.sh/hook": test-success
-spec:
-  initContainers:
-    - name: test-framework
-      image: "{{ .Values.testFramework.image}}:{{ .Values.testFramework.tag }}"
-      command:
-      - "bash"
-      - "-c"
-      - |
-        set -ex
-        # copy bats to tools dir
-        cp -R /usr/local/libexec/ /tools/bats/
-      volumeMounts:
-      - mountPath: /tools
-        name: tools
-  containers:
-    - name: {{ .Release.Name }}-test
-      {{- if eq .Values.backend.type "forward"}}
-      image: "fluent/fluentd:v1.4-debian-1"
-      {{- else }}
-      image: "dwdraju/alpine-curl-jq"
-      {{- end }}
-      command: ["/tools/bats/bats", "-t", "/tests/run.sh"]
-      {{- if and (eq .Values.backend.forward.tls "on") (eq .Values.backend.type "forward") }}
-      securityContext:
-        # run as root to install fluent gems
-        runAsUser: 0
-      {{- end }}
-      volumeMounts:
-        - mountPath: /tests
-          name: tests
-          readOnly: true
-        - mountPath: /tools
-          name: tools
-  volumes:
-  - name: tests
-    configMap:
-      name: {{ template "fluent-bit.fullname" . }}-test
-  - name: tools
-    emptyDir: {}
-  restartPolicy: Never
-{{- end }}
diff -uNr packages/logging/charts-original/values.yaml packages/logging/charts/values.yaml
--- packages/logging/charts-original/values.yaml	1969-12-31 17:00:00.000000000 -0700
+++ packages/logging/charts/values.yaml	2020-04-09 23:55:05.700024107 -0700
@@ -1,309 +1,11 @@
-# Minikube stores its logs in a separate directory.
-# Enable if you install the chart in minikube.
-on_minikube: false
-
-image:
-  fluent_bit:
-    repository: fluent/fluent-bit
-    tag: 1.3.7
-  pullPolicy: Always
-
-testFramework:
-  image: "dduportal/bats"
-  tag: "0.4.0"
-
-nameOverride: ""
-fullnameOverride: ""
-
-# When enabled, exposes json and prometheus metrics on {{ .Release.Name }}-metrics service
-metrics:
+fluentd:
   enabled: false
-  service:
-    # labels:
-    #   key: value
-    annotations: {}
-    # In order for Prometheus to consume metrics automatically use the following annotations:
-    # prometheus.io/path: "/api/v1/metrics/prometheus"
-    # prometheus.io/port: "2020"
-    # prometheus.io/scrape: "true"
-    port: 2020
-    type: ClusterIP
-  serviceMonitor:
-    enabled: false
-    additionalLabels: {}
-    # namespace: monitoring
-    # interval: 30s
-    # scrapeTimeout: 10s
-
-# When enabled, fluent-bit will keep track of tailing offsets across pod restarts.
-trackOffsets: false
-
-## PriorityClassName
-## Ref: https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/#priorityclass
-priorityClassName: ""
-
-backend:
-  type: forward
-  forward:
-    host: fluentd
-    port: 24284
-    tls: "off"
-    tls_verify: "on"
-    tls_debug: 1
-    shared_key:
-  es:
-    host: elasticsearch
-    port: 9200
-    # Elastic Index Name
-    index: kubernetes_cluster
-    type: flb_type
-    logstash_prefix: kubernetes_cluster
-    replace_dots: "On"
-    logstash_format: "On"
-    retry_limit: "False"
-    time_key: "@timestamp"
-    # Optional username credential for Elastic X-Pack access
-    http_user:
-    # Password for user defined in HTTP_User
-    http_passwd:
-    # Optional TLS encryption to ElasticSearch instance
-    tls: "off"
-    tls_verify: "on"
-    # TLS certificate for the Elastic (in PEM format). Use if tls=on and tls_verify=on.
-    tls_ca: ""
-    # TLS debugging levels = 1-4
-    tls_debug: 1
-  splunk:
-    host: 127.0.0.1
-    port: 8088
-    token: ""
-    send_raw: "on"
-    tls: "on"
-    tls_verify: "off"
-    tls_debug: 1
-    message_key: "kubernetes"
-  stackdriver: {}
-
-  ##
-  ## Ref: http://fluentbit.io/documentation/current/output/http.html
-  ##
-  http:
-    host: 127.0.0.1
-    port: 80
-    uri: "/"
-    http_user:
-    http_passwd:
-    tls: "off"
-    tls_verify: "on"
-    tls_debug: 1
-    ## Specify the data format to be used in the HTTP request body
-    ## Can be either 'msgpack' or 'json'
-    format: msgpack
-    # json_date_format: double or iso8601
-    headers: []
-
-parsers:
+fluentd-tester:
   enabled: false
-  ## List the respective parsers in key: value format per entry
-  ## Regex required fields are name and regex. JSON and Logfmt required field
-  ## is name.
-  regex: []
-  logfmt: []
-  ##  json parser config can be defined by providing an extraEntries field.
-  ##  The following entry:
-  ## json:
-  ##   - extraEntries: |
-  ##       Decode_Field_As  escaped log do_next
-  ##       Decode_Field_As  json log
-  ##
-  ##  translates into
-  ##
-  ##   Command       |  Decoder  | Field | Optional Action   |
-  ##   ==============|===========|=======|===================|
-  ##   Decode_Field_As  escaped   log  do_next
-  ##   Decode_Field_As  json log
-  ##
-  json: []
-
-env: []
-
-## Annotations to add to the DaemonSet's Pods
-podAnnotations: {}
-
-## By default there different 'files' provides in the config
-## (fluent-bit.conf, custom_parsers.conf). This defeats
-## changing a configmap (since it uses subPath). If this
-## variable is set, the user is assumed to have provided,
-## in 'existingConfigMap' the entire config (etc/*) of fluent-bit,
-## parsers and system config. In this case, no subPath is
-## used
-fullConfigMap: false
-
-## ConfigMap override where fullname is {{.Release.Name}}-{{.Values.existingConfigMap}}
-## Defining existingConfigMap will cause templates/config.yaml
-## to NOT generate a ConfigMap resource
-##
-existingConfigMap: ""
-
-
-# NOTE If you want to add extra sections, add them here, inbetween the includes,
-# wherever they need to go. Sections order matters.
-
-rawConfig: |-
-  @INCLUDE fluent-bit-service.conf
-  @INCLUDE fluent-bit-input.conf
-  @INCLUDE fluent-bit-filter.conf
-  @INCLUDE fluent-bit-output.conf
-
-
-# WARNING!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-# This is to add extra entries to an existing section, NOT for adding new sections
-# Do not submit bugs against indent being wrong. Add your new sections to rawConfig
-# instead.
-#
-extraEntries:
-  input: |-
-#     # >=1 additional Key/Value entrie(s) for existing Input section
-  audit: |-
-#     # >=1 additional Key/Value entrie(s) for existing Input section
-  filter: |-
-#     # >=1 additional Key/Value entrie(s) for existing Filter section
-  output: |-
-#     # >=1 additional Key/Value entrie(s) for existing Ouput section
-# WARNING!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-
-
-## Extra ports to add to the daemonset ports section
-extraPorts: []
-
-## Extra volumes containing additional files required for fluent-bit to work
-## (eg. CA certificates)
-## Ref: https://kubernetes.io/docs/concepts/storage/volumes/
-##
-extraVolumes: []
-
-## Extra volume mounts for the fluent-bit pod.
-## Ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-volume-storage/
-##
-extraVolumeMounts: []
-
-resources: {}
-  # limits:
-  #   cpu: 100m
-  #   memory: 128Mi
-  # requests:
-  #   cpu: 10m
-  #   memory: 8Mi
-
-# When enabled, pods will bind to the node's network namespace.
-hostNetwork: false
-
-# Which DNS policy to use for the pod.
-# Consider switching to 'ClusterFirstWithHostNet' when 'hostNetwork' is enabled.
-dnsPolicy: ClusterFirst
-
-## Node tolerations for fluent-bit scheduling to nodes with taints
-## Ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/
-##
-tolerations: []
-# - key: "key"
-#  operator: "Equal|Exists"
-#  value: "value"
-#  effect: "NoSchedule|PreferNoSchedule|NoExecute(1.6 only)"
-
-## Node labels for fluent-bit pod assignment
-## Ref: https://kubernetes.io/docs/user-guide/node-selection/
-##
-nodeSelector: {}
-affinity: {}
-
-service:
-  flush: 1
-  logLevel: info
-
-input:
-  tail:
-    memBufLimit: 5MB
-    parser: docker
-    path: /var/log/containers/*.log
-    ignore_older: ""
-  systemd:
-    enabled: false
-    filters:
-      systemdUnit:
-        - docker.service
-        - kubelet.service
-        - node-problem-detector.service
-    maxEntries: 1000
-    readFromTail: true
-    stripUnderscores: false
-    tag: host.*
-
-audit:
-  enable: false
-  input:
-    memBufLimit: 35MB
-    parser: docker
-    tag: audit.*
-    path: /var/log/kube-apiserver-audit.log
-    bufferChunkSize: 2MB
-    bufferMaxSize: 10MB
-    skipLongLines: On
-    key: kubernetes-audit
-
-filter:
-  kubeURL: https://kubernetes.default.svc:443
-  kubeCAFile: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
-  kubeTokenFile: /var/run/secrets/kubernetes.io/serviceaccount/token
-  kubeTag: kube
-  kubeTagPrefix: kube.var.log.containers.
-
-# If true, check to see if the log field content is a JSON string map, if so,
-# it append the map fields as part of the log structure.
-  mergeJSONLog: true
-
-# If set, all unpacked keys from mergeJSONLog (Merge_Log) will be packed under
-# the key name specified on mergeLogKey (Merge_Log_Key)
-  mergeLogKey: ""
-
-# If true, enable the use of monitoring for a pod annotation of
-# fluentbit.io/parser: parser_name. parser_name must be the name
-# of a parser contained within parsers.conf
-  enableParser: true
-
-# If true, enable the use of monitoring for a pod annotation of
-# fluentbit.io/exclude: true. If present, discard logs from that pod.
-  enableExclude: true
-
-# If true, the filter reads logs coming in Journald format.
-  useJournal: false
-
-rbac:
-  # Specifies whether RBAC resources should be created
-  create: true
-  # Specifies whether a PodSecurityPolicy should be created
-  pspEnabled: false
-
-taildb:
-  directory: /var/lib/fluent-bit
-
-serviceAccount:
-  # Specifies whether a ServiceAccount should be created
-  create: true
-  # Annotations to add to the service account
-  annotations: {}
-  # The name of the ServiceAccount to use.
-  # If not set and create is true, a name is generated using the fullname template
-  name:
-
-## Specifies security settings for a container
-## Ref: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-container
-securityContext: {}
-  # securityContext:
-  #   privileged: true
-
-## Specifies security settings for a pod
-## Ref: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-pod
-podSecurityContext: {}
-  # podSecurityContext:
-  #   runAsUser: 1000
+log-aggregator:
+  enabled: false
+global:
+  systemDefaultRegistry: ""
+  podSecurityPolicy:
+    enabled: true
+  privileged: false
